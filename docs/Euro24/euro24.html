<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Oliver DÃ¼rr">

<title>da_website - Bayes is coming home - Predicting the Euro 2024 with Stan</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">da_website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Stan_Primer_Full.html"> 
<span class="menu-text">Stan primer</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lecture-notes" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lecture Notes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lecture-notes">    
        <li>
    <a class="dropdown-item" href="../lecture_notes/MCMC/MCMC.html">
 <span class="dropdown-text">MCMC</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#prediction-based-on-the-historical-data" id="toc-prediction-based-on-the-historical-data" class="nav-link active" data-scroll-target="#prediction-based-on-the-historical-data">Prediction based on the Historical Data</a></li>
  <li><a href="#loading-the-data" id="toc-loading-the-data" class="nav-link" data-scroll-target="#loading-the-data">Loading the data</a></li>
  <li><a href="#a-model-for-the-goals-scored" id="toc-a-model-for-the-goals-scored" class="nav-link" data-scroll-target="#a-model-for-the-goals-scored">A Model for the goals scored ðŸ¥…</a>
  <ul class="collapse">
  <li><a href="#prior-for-the-attack-and-defence-strength" id="toc-prior-for-the-attack-and-defence-strength" class="nav-link" data-scroll-target="#prior-for-the-attack-and-defence-strength">Prior for the attack and defence strength</a></li>
  </ul></li>
  <li><a href="#conditioning-on-the-data-fitting-the-model" id="toc-conditioning-on-the-data-fitting-the-model" class="nav-link" data-scroll-target="#conditioning-on-the-data-fitting-the-model">Conditioning on the data / Fitting the model</a></li>
  <li><a href="#the-fitted-model" id="toc-the-fitted-model" class="nav-link" data-scroll-target="#the-fitted-model">The fitted model</a></li>
  <li><a href="#predictions" id="toc-predictions" class="nav-link" data-scroll-target="#predictions">Predictions</a>
  <ul class="collapse">
  <li><a href="#details-on-individual-games" id="toc-details-on-individual-games" class="nav-link" data-scroll-target="#details-on-individual-games">Details on individual games</a>
  <ul class="collapse">
  <li><a href="#goal-distributions" id="toc-goal-distributions" class="nav-link" data-scroll-target="#goal-distributions">Goal Distributions</a></li>
  </ul></li>
  <li><a href="#germany-vs-scotland" id="toc-germany-vs-scotland" class="nav-link" data-scroll-target="#germany-vs-scotland">1 Germany vs Scotland</a></li>
  <li><a href="#hungary-vs-switzerland" id="toc-hungary-vs-switzerland" class="nav-link" data-scroll-target="#hungary-vs-switzerland">2 Hungary vs Switzerland</a></li>
  <li><a href="#spain-vs-croatia" id="toc-spain-vs-croatia" class="nav-link" data-scroll-target="#spain-vs-croatia">3 Spain vs Croatia</a></li>
  <li><a href="#italy-vs-albania" id="toc-italy-vs-albania" class="nav-link" data-scroll-target="#italy-vs-albania">4 Italy vs Albania</a></li>
  <li><a href="#serbia-vs-england" id="toc-serbia-vs-england" class="nav-link" data-scroll-target="#serbia-vs-england">5 Serbia vs England</a></li>
  <li><a href="#slovenia-vs-denmark" id="toc-slovenia-vs-denmark" class="nav-link" data-scroll-target="#slovenia-vs-denmark">6 Slovenia vs Denmark</a></li>
  <li><a href="#poland-vs-netherlands" id="toc-poland-vs-netherlands" class="nav-link" data-scroll-target="#poland-vs-netherlands">7 Poland vs Netherlands</a></li>
  <li><a href="#austria-vs-france" id="toc-austria-vs-france" class="nav-link" data-scroll-target="#austria-vs-france">8 Austria vs France</a></li>
  <li><a href="#belgium-vs-slovakia" id="toc-belgium-vs-slovakia" class="nav-link" data-scroll-target="#belgium-vs-slovakia">9 Belgium vs Slovakia</a></li>
  <li><a href="#romania-vs-ukraine" id="toc-romania-vs-ukraine" class="nav-link" data-scroll-target="#romania-vs-ukraine">10 Romania vs Ukraine</a></li>
  <li><a href="#tÃ¼rkiye-vs-georgia" id="toc-tÃ¼rkiye-vs-georgia" class="nav-link" data-scroll-target="#tÃ¼rkiye-vs-georgia">11 TÃ¼rkiye vs Georgia</a></li>
  <li><a href="#portugal-vs-czechia" id="toc-portugal-vs-czechia" class="nav-link" data-scroll-target="#portugal-vs-czechia">12 Portugal vs Czechia</a></li>
  <li><a href="#scotland-vs-switzerland" id="toc-scotland-vs-switzerland" class="nav-link" data-scroll-target="#scotland-vs-switzerland">13 Scotland vs Switzerland</a></li>
  <li><a href="#germany-vs-hungary" id="toc-germany-vs-hungary" class="nav-link" data-scroll-target="#germany-vs-hungary">14 Germany vs Hungary</a></li>
  <li><a href="#croatia-vs-albania" id="toc-croatia-vs-albania" class="nav-link" data-scroll-target="#croatia-vs-albania">15 Croatia vs Albania</a></li>
  <li><a href="#spain-vs-italy" id="toc-spain-vs-italy" class="nav-link" data-scroll-target="#spain-vs-italy">16 Spain vs Italy</a></li>
  <li><a href="#denmark-vs-england" id="toc-denmark-vs-england" class="nav-link" data-scroll-target="#denmark-vs-england">17 Denmark vs England</a></li>
  <li><a href="#slovenia-vs-serbia" id="toc-slovenia-vs-serbia" class="nav-link" data-scroll-target="#slovenia-vs-serbia">18 Slovenia vs Serbia</a></li>
  <li><a href="#poland-vs-austria" id="toc-poland-vs-austria" class="nav-link" data-scroll-target="#poland-vs-austria">19 Poland vs Austria</a></li>
  <li><a href="#netherlands-vs-france" id="toc-netherlands-vs-france" class="nav-link" data-scroll-target="#netherlands-vs-france">20 Netherlands vs France</a></li>
  <li><a href="#slovakia-vs-ukraine" id="toc-slovakia-vs-ukraine" class="nav-link" data-scroll-target="#slovakia-vs-ukraine">21 Slovakia vs Ukraine</a></li>
  <li><a href="#belgium-vs-romania" id="toc-belgium-vs-romania" class="nav-link" data-scroll-target="#belgium-vs-romania">22 Belgium vs Romania</a></li>
  <li><a href="#tÃ¼rkiye-vs-portugal" id="toc-tÃ¼rkiye-vs-portugal" class="nav-link" data-scroll-target="#tÃ¼rkiye-vs-portugal">23 TÃ¼rkiye vs Portugal</a></li>
  <li><a href="#georgia-vs-czechia" id="toc-georgia-vs-czechia" class="nav-link" data-scroll-target="#georgia-vs-czechia">24 Georgia vs Czechia</a></li>
  <li><a href="#switzerland-vs-germany" id="toc-switzerland-vs-germany" class="nav-link" data-scroll-target="#switzerland-vs-germany">25 Switzerland vs Germany</a></li>
  <li><a href="#scotland-vs-hungary" id="toc-scotland-vs-hungary" class="nav-link" data-scroll-target="#scotland-vs-hungary">26 Scotland vs Hungary</a></li>
  <li><a href="#albania-vs-spain" id="toc-albania-vs-spain" class="nav-link" data-scroll-target="#albania-vs-spain">27 Albania vs Spain</a></li>
  <li><a href="#croatia-vs-italy" id="toc-croatia-vs-italy" class="nav-link" data-scroll-target="#croatia-vs-italy">28 Croatia vs Italy</a></li>
  <li><a href="#england-vs-slovenia" id="toc-england-vs-slovenia" class="nav-link" data-scroll-target="#england-vs-slovenia">29 England vs Slovenia</a></li>
  <li><a href="#denmark-vs-serbia" id="toc-denmark-vs-serbia" class="nav-link" data-scroll-target="#denmark-vs-serbia">30 Denmark vs Serbia</a></li>
  <li><a href="#netherlands-vs-austria" id="toc-netherlands-vs-austria" class="nav-link" data-scroll-target="#netherlands-vs-austria">31 Netherlands vs Austria</a></li>
  <li><a href="#france-vs-poland" id="toc-france-vs-poland" class="nav-link" data-scroll-target="#france-vs-poland">32 France vs Poland</a></li>
  <li><a href="#slovakia-vs-romania" id="toc-slovakia-vs-romania" class="nav-link" data-scroll-target="#slovakia-vs-romania">33 Slovakia vs Romania</a></li>
  <li><a href="#ukraine-vs-belgium" id="toc-ukraine-vs-belgium" class="nav-link" data-scroll-target="#ukraine-vs-belgium">34 Ukraine vs Belgium</a></li>
  <li><a href="#georgia-vs-portugal" id="toc-georgia-vs-portugal" class="nav-link" data-scroll-target="#georgia-vs-portugal">35 Georgia vs Portugal</a></li>
  <li><a href="#czechia-vs-tÃ¼rkiye" id="toc-czechia-vs-tÃ¼rkiye" class="nav-link" data-scroll-target="#czechia-vs-tÃ¼rkiye">36 Czechia vs TÃ¼rkiye</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Bayes is coming home - Predicting the Euro 2024 with Stan</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Oliver DÃ¼rr </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>The Euro 2024 âš½ is a nice showcase of Bayesian Statistics. In Bayesian statistics, probabilities are seen as a degree of belief, which fits well with the nature of football. Almost everyone has beliefs about the strengths and weaknesses of the teams before seeing any games (based on historical data) and then updates these beliefs as new data comes in (games have been played).</p>
<section id="prediction-based-on-the-historical-data" class="level2">
<h2 class="anchored" data-anchor-id="prediction-based-on-the-historical-data">Prediction based on the Historical Data</h2>
<p>We load the matches prior to the Euro 2024, see <a href="https://github.com/oduerr/da/blob/master/stan/Euro24/Euro_Data.md" class="uri">https://github.com/oduerr/da/blob/master/stan/Euro24/Euro_Data.md</a> how to get the data. Note the limitations of using historic; for example, Germany only started finding their form shortly before Euro 2024.</p>
</section>
<section id="loading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-data">Loading the data</h2>
<p>Loaded 116 games with 24 teams.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Expand To Learn How to set up the data for Stan
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<section id="preparing-the-data-for-stan" class="level2 callout-body-container callout-body">
<h2 class="anchored" data-anchor-id="preparing-the-data-for-stan">Preparing the data for Stan</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Some R-Magic to convert the team names to numbers, no need to understand this</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>ng <span class="ot">=</span> <span class="fu">nrow</span>(data)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>teams <span class="ot">=</span> <span class="fu">unique</span>(data<span class="sc">$</span>Home)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>nt <span class="ot">=</span> <span class="fu">length</span>(teams)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>ht <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>ng, <span class="cf">function</span>(g) <span class="fu">which</span>(teams <span class="sc">==</span> data<span class="sc">$</span>Home[g])))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>at <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>ng, <span class="cf">function</span>(g) <span class="fu">which</span>(teams <span class="sc">==</span> data<span class="sc">$</span>Away[g])))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>np<span class="ot">=</span><span class="dv">1</span> <span class="co">#Number games leaving out for prediction</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>ngob <span class="ot">=</span> ng<span class="sc">-</span>np <span class="co">#ngames obsered ngob = number of games to fit</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#print(paste0("Using the first ", ngob, " games to fit the model and ", np, " games to predict.", "Num teams ",  length(teams)))</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">=</span> <span class="fu">list</span>(</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">nt =</span> nt, </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ng =</span> ngob,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ht =</span> ht[<span class="dv">1</span><span class="sc">:</span>ngob], </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">at =</span> at[<span class="dv">1</span><span class="sc">:</span>ngob], </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">s1 =</span> data<span class="sc">$</span>score1[<span class="dv">1</span><span class="sc">:</span>ngob],</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">s2 =</span> data<span class="sc">$</span>score2[<span class="dv">1</span><span class="sc">:</span>ngob],</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">np =</span> np,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">htnew =</span> ht[(ngob<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>ng],</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">atnew =</span> at[(ngob<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>ng]</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Using the first 115 games to fit the model and 1 games to predict. In total we have 24 teams.</p>
</section>
</div>
</div>
</section>
<section id="a-model-for-the-goals-scored" class="level2">
<h2 class="anchored" data-anchor-id="a-model-for-the-goals-scored">A Model for the goals scored ðŸ¥…</h2>
<p>We will assume that the number of goals scored by the home team <span class="math inline">\(s_1\)</span> and the away team <span class="math inline">\(s_2\)</span> follows a Poisson distribution. This has been shown to be a good model for the number of goals scored in a football match. We model the rate parameter <span class="math inline">\(\theta\)</span> of the Poisson distribution, related to the attack and defense strengths of the teams, as follows:</p>
<pre><code>$$
s_1 \sim \text{Pois}(\theta_1) \quad\text{goals scored by the home team}
$$

$$
s_2 \sim \text{Pois}(\theta_2) \quad\text{goals scored by the away team}
$$ </code></pre>
<p>This is equivalent to performing two separate Poisson regressions, one for each team.</p>
<p>We assume that:</p>
<pre><code>$$
\theta_1 = \exp(\text{home} + \text{att}\text{ht} - \text{def}\text{at})
$$

$$
\theta_2 = \exp(\text{att}\text{at} - \text{def}\text{ht})
$$</code></pre>
<p>Since there is no home advantage in the Euro (except for Germany), we set <span class="math inline">\(\text{home} = 0\)</span>.</p>
<section id="prior-for-the-attack-and-defence-strength" class="level3">
<h3 class="anchored" data-anchor-id="prior-for-the-attack-and-defence-strength">Prior for the attack and defence strength</h3>
<p>In Bayesian statistics, we further need to specify a prior for the parameters (our degree of believe in the attack and defense abilities before seeing any data). For that we use a hierarchical model with correlated parameters. Other models are investigated at <a href="https://github.com/oduerr/da/blob/master/stan/football/Correlated.md" class="uri">https://github.com/oduerr/da/blob/master/stan/football/Correlated.md</a> for the English Premier League 2019/2020 season where the hiearchical model have been especially successfull. The model is adopted from the <a href="https://github.com/MaggieLieu/STAN_tutorials/tree/master/Hierarchical">blog_post</a> and the <a href="https://discovery.ucl.ac.uk/id/eprint/16040/1/16040.pdf">paper</a>. The model is written in the probabilistic programming language Stan and can be found at <a href="https://github.com/oduerr/da/blob/master/website/Euro24/hier_model_cor.stan" class="uri">https://github.com/oduerr/da/blob/master/website/Euro24/hier_model_cor.stan</a>.</p>
</section>
</section>
<section id="conditioning-on-the-data-fitting-the-model" class="level2">
<h2 class="anchored" data-anchor-id="conditioning-on-the-data-fitting-the-model">Conditioning on the data / Fitting the model</h2>
<p>After we state the model we fit the model to the data, or in Bayesian parlance, we update our degree of belief after seeing the data.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Expand MCMC sampling with Stan
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>hmodel <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="st">'~/Documents/GitHub/da/website/Euro24/hier_model_cor.stan'</span>) </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>hfit <span class="ot">=</span> hmodel<span class="sc">$</span><span class="fu">sample</span>(<span class="at">data =</span> my_data)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Running MCMC with 4 chains, at most 10 in parallel...</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration:  100 / 2000 [  5%]  (Warmup) </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration:  200 / 2000 [ 10%]  (Warmup) </span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration:  300 / 2000 [ 15%]  (Warmup) </span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration:  100 / 2000 [  5%]  (Warmup) </span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration:  200 / 2000 [ 10%]  (Warmup) </span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration:  300 / 2000 [ 15%]  (Warmup) </span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration:  100 / 2000 [  5%]  (Warmup) </span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration:  200 / 2000 [ 10%]  (Warmup) </span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) </span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration:  100 / 2000 [  5%]  (Warmup) </span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration:  200 / 2000 [ 10%]  (Warmup) </span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration:  300 / 2000 [ 15%]  (Warmup) </span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration:  400 / 2000 [ 20%]  (Warmup) </span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration:  600 / 2000 [ 30%]  (Warmup) </span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration:  700 / 2000 [ 35%]  (Warmup) </span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration:  800 / 2000 [ 40%]  (Warmup) </span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration:  400 / 2000 [ 20%]  (Warmup) </span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration:  300 / 2000 [ 15%]  (Warmup) </span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration:  400 / 2000 [ 20%]  (Warmup) </span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration:  600 / 2000 [ 30%]  (Warmup) </span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration:  400 / 2000 [ 20%]  (Warmup) </span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration:  500 / 2000 [ 25%]  (Warmup) </span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration:  600 / 2000 [ 30%]  (Warmup) </span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration:  700 / 2000 [ 35%]  (Warmup) </span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration:  900 / 2000 [ 45%]  (Warmup) </span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration: 1100 / 2000 [ 55%]  (Sampling) </span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration:  600 / 2000 [ 30%]  (Warmup) </span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration:  700 / 2000 [ 35%]  (Warmup) </span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration:  800 / 2000 [ 40%]  (Warmup) </span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration:  900 / 2000 [ 45%]  (Warmup) </span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration:  700 / 2000 [ 35%]  (Warmup) </span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration:  800 / 2000 [ 40%]  (Warmup) </span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration:  900 / 2000 [ 45%]  (Warmup) </span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration:  800 / 2000 [ 40%]  (Warmup) </span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration:  900 / 2000 [ 45%]  (Warmup) </span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration: 1100 / 2000 [ 55%]  (Sampling) </span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration: 1200 / 2000 [ 60%]  (Sampling) </span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration: 1300 / 2000 [ 65%]  (Sampling) </span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration: 1400 / 2000 [ 70%]  (Sampling) </span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) </span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) </span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration: 1100 / 2000 [ 55%]  (Sampling) </span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration: 1200 / 2000 [ 60%]  (Sampling) </span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration: 1100 / 2000 [ 55%]  (Sampling) </span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration: 1200 / 2000 [ 60%]  (Sampling) </span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration: 1300 / 2000 [ 65%]  (Sampling) </span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration: 1200 / 2000 [ 60%]  (Sampling) </span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration: 1300 / 2000 [ 65%]  (Sampling) </span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration: 1400 / 2000 [ 70%]  (Sampling) </span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration: 1600 / 2000 [ 80%]  (Sampling) </span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration: 1700 / 2000 [ 85%]  (Sampling) </span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration: 1300 / 2000 [ 65%]  (Sampling) </span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration: 1400 / 2000 [ 70%]  (Sampling) </span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration: 1400 / 2000 [ 70%]  (Sampling) </span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration: 1600 / 2000 [ 80%]  (Sampling) </span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration: 1800 / 2000 [ 90%]  (Sampling) </span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration: 1900 / 2000 [ 95%]  (Sampling) </span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration: 1500 / 2000 [ 75%]  (Sampling) </span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration: 1600 / 2000 [ 80%]  (Sampling) </span></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration: 1600 / 2000 [ 80%]  (Sampling) </span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration: 1700 / 2000 [ 85%]  (Sampling) </span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration: 1800 / 2000 [ 90%]  (Sampling) </span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration: 1700 / 2000 [ 85%]  (Sampling) </span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration: 1800 / 2000 [ 90%]  (Sampling) </span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration: 1900 / 2000 [ 95%]  (Sampling) </span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 1 finished in 0.7 seconds.</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration: 1700 / 2000 [ 85%]  (Sampling) </span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration: 1800 / 2000 [ 90%]  (Sampling) </span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration: 1900 / 2000 [ 95%]  (Sampling) </span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration: 1900 / 2000 [ 95%]  (Sampling) </span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 3 finished in 0.8 seconds.</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 4 finished in 0.7 seconds.</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) </span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a><span class="do">## Chain 2 finished in 0.8 seconds.</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a><span class="do">## All 4 chains finished successfully.</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a><span class="do">## Mean chain execution time: 0.7 seconds.</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a><span class="do">## Total execution time: 1.0 seconds.</span></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> bayesplot<span class="sc">::</span><span class="fu">mcmc_rhat_hist</span>(bayesplot<span class="sc">::</span><span class="fu">rhat</span>(hfit))</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> bayesplot<span class="sc">::</span><span class="fu">mcmc_neff_hist</span>(bayesplot<span class="sc">::</span><span class="fu">neff_ratio</span>(hfit))</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>ggpubr<span class="sc">::</span><span class="fu">ggarrange</span>(p1, p2, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="euro24_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The fitting of the model is good, as the Rhat values are close to 1 and we have no divergent transitions. The effective sample size is also good.</p>
</div>
</div>
</div>
</section>
<section id="the-fitted-model" class="level2">
<h2 class="anchored" data-anchor-id="the-fitted-model">The fitted model</h2>
<p>We plot the means of the attack and defense strengths of the teams. Shown are the mean values along with the 25% and 75% quantiles. There is considerable uncertainty in the strengths of the teams, but thatâ€™s the nature of the game.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Gather draws and calculate summary statistics with credible intervals</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> hfit <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">gather_draws</span>(A[i, j]) <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(i, j) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">average_value =</span> <span class="fu">mean</span>(.value),</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">quantile</span>(.value, <span class="fl">0.25</span>),  <span class="co"># Lower bound </span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fu">quantile</span>(.value, <span class="fl">0.75</span>),  <span class="co"># Upper bound </span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Create a matrix of the average values</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>A <span class="ot">=</span> <span class="fu">xtabs</span>(average_value <span class="sc">~</span> i <span class="sc">+</span> j, <span class="at">data =</span> d)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Plot the average values</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(A[<span class="dv">1</span>,], A[<span class="dv">2</span>,], <span class="at">pch=</span><span class="dv">20</span>, <span class="at">xlab=</span><span class="st">'Attack'</span>, <span class="at">ylab=</span><span class="st">'Defence'</span>, <span class="at">main=</span><span class="st">'Attack vs Defence'</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Add team labels</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(A[<span class="dv">1</span>,], A[<span class="dv">2</span>,], <span class="at">labels=</span>teams, <span class="at">cex=</span><span class="fl">0.7</span>, <span class="at">adj=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.05</span>, <span class="sc">-</span><span class="fl">0.8</span>))</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Add error bars for 66% credibility intervals</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape data for plotting</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>d_wide <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">spread</span>(<span class="at">key =</span> j, <span class="at">value =</span> average_value)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>d_lower <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">spread</span>(<span class="at">key =</span> j, <span class="at">value =</span> lower)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>d_upper <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span> <span class="fu">spread</span>(<span class="at">key =</span> j, <span class="at">value =</span> upper)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to matrices for easier plotting</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>A_lower <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(lower <span class="sc">~</span> i <span class="sc">+</span> j, <span class="at">data =</span> d)</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>A_upper <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(upper <span class="sc">~</span> i <span class="sc">+</span> j, <span class="at">data =</span> d)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot vertical error bars</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(A[<span class="dv">1</span>,], A_lower[<span class="dv">2</span>,], A[<span class="dv">1</span>,], A_upper[<span class="dv">2</span>,], <span class="at">angle=</span><span class="dv">90</span>, <span class="at">code=</span><span class="dv">3</span>, <span class="at">length=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">"lightblue"</span>, <span class="at">alpha=</span><span class="fl">0.5</span>)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot horizontal error bars</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(A_lower[<span class="dv">1</span>,], A[<span class="dv">2</span>,], A_upper[<span class="dv">1</span>,], A[<span class="dv">2</span>,], <span class="at">angle=</span><span class="dv">90</span>, <span class="at">code=</span><span class="dv">3</span>, <span class="at">length=</span><span class="fl">0.05</span>, <span class="at">col=</span><span class="st">"lightblue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="euro24_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example Prediction Germany vs Scotland
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>The opening game of Euro 2024 was Germany vs.&nbsp;Scotland. In the plots below, we show the posterior probabilities for the attack and defense strengths of the teams.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate probabilities for a pairing</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>id1 <span class="ot">&lt;-</span> <span class="fu">which</span>(teams <span class="sc">==</span> <span class="st">'Germany'</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>id2 <span class="ot">&lt;-</span> <span class="fu">which</span>(teams <span class="sc">==</span> <span class="st">'Scotland'</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract posterior distributions for Attack and Defense</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>attack_germany <span class="ot">&lt;-</span> hfit <span class="sc">%&gt;%</span> tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(A[i, j]) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(j <span class="sc">==</span> id1, i <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(A)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>attack_scotland <span class="ot">&lt;-</span> hfit <span class="sc">%&gt;%</span> tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(A[i, j]) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(j <span class="sc">==</span> id2, i <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(A)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>defense_germany <span class="ot">&lt;-</span> hfit <span class="sc">%&gt;%</span> tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(A[i, j]) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(j <span class="sc">==</span> id1, i <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(A)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>defense_scotland <span class="ot">&lt;-</span> hfit <span class="sc">%&gt;%</span> tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(A[i, j]) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(j <span class="sc">==</span> id2, i <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(A)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine data into a tidy data frame</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>tidy_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  attack_germany <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Statistic =</span> <span class="st">"Attack"</span>, <span class="at">Country =</span> <span class="st">"Germany"</span>),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  attack_scotland <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Statistic =</span> <span class="st">"Attack"</span>, <span class="at">Country =</span> <span class="st">"Scotland"</span>),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  defense_germany <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Statistic =</span> <span class="st">"Defense"</span>, <span class="at">Country =</span> <span class="st">"Germany"</span>),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  defense_scotland <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Statistic =</span> <span class="st">"Defense"</span>, <span class="at">Country =</span> <span class="st">"Scotland"</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Include the mean values in the plot</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tidy_df, <span class="fu">aes</span>(<span class="at">x =</span> A, <span class="at">fill =</span> Country)) <span class="sc">+</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Statistic, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Posterior Distributions of Attack and Defense Strengths"</span>, <span class="at">x =</span> <span class="st">"Strength"</span>, <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> tidy_df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Statistic, Country) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">mean_A =</span> <span class="fu">mean</span>(A)), </span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept =</span> mean_A, <span class="at">color =</span> Country), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="euro24_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="making-predictions" class="level3">
<h3 class="anchored" data-anchor-id="making-predictions">Making predictions</h3>
<p>We can now make predictions for the game Germany vs Scotland. Below are the first samples of the posterior distribution for the attack and defense strengths of germany and scotland.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract first five samples for demonstration</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">attack_germany =</span> attack_germany<span class="sc">$</span>A, <span class="at">defense_germany =</span> defense_germany<span class="sc">$</span>A, <span class="at">attack_scotland =</span> attack_scotland<span class="sc">$</span>A, <span class="at">defense_scotland =</span> defense_scotland<span class="sc">$</span>A) <span class="sc">%&gt;%</span> <span class="fu">head</span>() </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">attack_germany</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">defense_germany</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">attack_scotland</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">defense_scotland</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.0779213</td>
<td style="text-align: right;">0.0303593</td>
<td style="text-align: right;">-0.1178210</td>
<td style="text-align: right;">-0.0299219</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.3680130</td>
<td style="text-align: right;">0.0384326</td>
<td style="text-align: right;">0.2218090</td>
<td style="text-align: right;">-0.0392805</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.1257070</td>
<td style="text-align: right;">-0.0325476</td>
<td style="text-align: right;">-0.0477489</td>
<td style="text-align: right;">-0.1763580</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.1464220</td>
<td style="text-align: right;">-0.0856594</td>
<td style="text-align: right;">-0.2955400</td>
<td style="text-align: right;">-0.3487970</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0.3694650</td>
<td style="text-align: right;">-0.0549185</td>
<td style="text-align: right;">0.0723635</td>
<td style="text-align: right;">-0.1794980</td>
</tr>
<tr class="even">
<td style="text-align: right;">0.0532624</td>
<td style="text-align: right;">0.0105785</td>
<td style="text-align: right;">-0.0713649</td>
<td style="text-align: right;">-0.5267700</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
<p>We use the samples for posterior row by row to sample the number of goals for Germany and Scotland. We can use the samples to calculate the probability of a win, draw or loss for Germany.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a> theta_germany <span class="ot">=</span> <span class="fu">exp</span>(attack_germany<span class="sc">$</span>A <span class="sc">-</span> defense_scotland<span class="sc">$</span>A)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a> theta_scotland <span class="ot">=</span> <span class="fu">exp</span>(attack_scotland<span class="sc">$</span>A <span class="sc">-</span> defense_germany<span class="sc">$</span>A)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a> g_germany <span class="ot">=</span> <span class="fu">rpois</span>(<span class="fu">length</span>(theta_germany), theta_germany)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a> g_scotland <span class="ot">=</span> <span class="fu">rpois</span>(<span class="fu">length</span>(theta_scotland), theta_scotland)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">mean</span>(g_germany <span class="sc">&gt;</span> g_scotland) <span class="co">#Probability of Germany winning</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.46175</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">mean</span>(g_germany <span class="sc">==</span> g_scotland) <span class="co">#Probability of a draw</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.26775</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">mean</span>(g_germany <span class="sc">&lt;</span> g_scotland) <span class="co">#Probability of Scotland winning</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2705</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(<span class="fu">table</span>(g_germany)<span class="sc">/</span><span class="fu">length</span>(g_germany), <span class="at">main=</span><span class="st">'Germany Goals'</span>, <span class="at">xlab=</span><span class="st">'Goals'</span>, <span class="at">ylab=</span><span class="st">'Probability'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="euro24_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(<span class="fu">table</span>(g_scotland)<span class="sc">/</span><span class="fu">length</span>(g_scotland), <span class="at">main=</span><span class="st">'Scotland Goals'</span>, <span class="at">xlab=</span><span class="st">'Goals'</span>, <span class="at">ylab=</span><span class="st">'Probability'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="euro24_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Remember the result? It was 5:1 for Germany. The model predicted a win for Germany with a probability of 0.46. The probability of a draw was 0.27 and the probability of Scotland winning was 0.27.</p>
<p>So that these predictions with a grain of salt. The model is based on historical data and does not take into account the current form of the teams.</p>
</section>
</div>
</div>
</div>
</section>
<section id="predictions" class="level1">
<h1>Predictions</h1>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that these predictions are based on historical data and might do not take into account the current form of the teams.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to calculate probabilities for a pairing</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>calculate_probabilities <span class="ot">&lt;-</span> <span class="cf">function</span>(team1, team2, teams, hfit) {</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">'## %s vs %s</span><span class="sc">\n</span><span class="st">'</span>, team1, team2))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  id1 <span class="ot">&lt;-</span> <span class="fu">which</span>(teams <span class="sc">==</span> team1)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  id2 <span class="ot">&lt;-</span> <span class="fu">which</span>(teams <span class="sc">==</span> team2)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Spread draws and filter the relevant data</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  As <span class="ot">&lt;-</span> hfit <span class="sc">%&gt;%</span> tidybayes<span class="sc">::</span><span class="fu">spread_draws</span>(A[i, j]) <span class="sc">%&gt;%</span> <span class="fu">select</span>(i, j, A)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  att_1 <span class="ot">&lt;-</span> As <span class="sc">%&gt;%</span> <span class="fu">filter</span>(j <span class="sc">==</span> id1, i <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  att_2 <span class="ot">&lt;-</span> As <span class="sc">%&gt;%</span> <span class="fu">filter</span>(j <span class="sc">==</span> id2, i <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  def_1 <span class="ot">&lt;-</span> As <span class="sc">%&gt;%</span> <span class="fu">filter</span>(j <span class="sc">==</span> id1, i <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  def_2 <span class="ot">&lt;-</span> As <span class="sc">%&gt;%</span> <span class="fu">filter</span>(j <span class="sc">==</span> id2, i <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  theta_1 <span class="ot">&lt;-</span> <span class="fu">exp</span>(att_1<span class="sc">$</span>A <span class="sc">-</span> def_2<span class="sc">$</span>A)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  theta_2 <span class="ot">&lt;-</span> <span class="fu">exp</span>(att_2<span class="sc">$</span>A <span class="sc">-</span> def_1<span class="sc">$</span>A)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  g_1 <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="fu">length</span>(theta_1), theta_1)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  g_2 <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="fu">length</span>(theta_2), theta_2)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate probabilities</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  prob_win <span class="ot">&lt;-</span> <span class="fu">mean</span>(g_1 <span class="sc">&gt;</span> g_2)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  prob_draw <span class="ot">&lt;-</span> <span class="fu">mean</span>(g_1 <span class="sc">==</span> g_2)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  prob_lose <span class="ot">&lt;-</span> <span class="fu">mean</span>(g_1 <span class="sc">&lt;</span> g_2)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the probabilities and goals</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob_win =</span> <span class="fu">round</span>(prob_win,<span class="dv">2</span>),</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob_draw =</span> <span class="fu">round</span>(prob_draw,<span class="dv">2</span>),</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">prob_lose =</span> <span class="fu">round</span>(prob_lose,<span class="dv">2</span>),</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">g_1 =</span> g_1,</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">g_2 =</span> g_2</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a><span class="do">### Group stage matches</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Quite a pain to get the data in the right format from a lying ChatGPT</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the data from the CSV</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>csv_data <span class="ot">&lt;-</span> <span class="st">"MatchNumber, Date, Team1, Team2, KickoffTime</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a><span class="st">1, 14.06, Germany, Scotland, 21:00</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="st">2, 15.06, Hungary, Switzerland, 15:00</span></span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a><span class="st">3, 15.06, Spain, Croatia, 18:00</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="st">4, 15.06, Italy, Albania, 21:00</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a><span class="st">5, 16.06, Serbia, England, 21:00</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a><span class="st">6, 16.06, Slovenia, Denmark, 18:00</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a><span class="st">7, 16.06, Poland, Netherlands, 15:00</span></span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a><span class="st">8, 17.06, Austria, France, 21:00</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a><span class="st">9, 17.06, Belgium, Slovakia, 18:00</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a><span class="st">10, 17.06, Romania, Ukraine, 15:00</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a><span class="st">11, 18.06, TÃ¼rkiye, Georgia, 18:00</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a><span class="st">12, 18.06, Portugal, Czechia, 21:00</span></span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a><span class="st">13, 19.06, Scotland, Switzerland, 21:00</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a><span class="st">14, 19.06, Germany, Hungary, 18:00</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a><span class="st">15, 19.06, Croatia, Albania, 15:00</span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a><span class="st">16, 19.06, Spain, Italy, 21:00</span></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a><span class="st">17, 20.06, Denmark, England, 18:00</span></span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a><span class="st">18, 20.06, Slovenia, Serbia, 15:00</span></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a><span class="st">19, 20.06, Poland, Austria, 18:00</span></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a><span class="st">20, 20.06, Netherlands, France, 21:00</span></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a><span class="st">21, 21.06, Slovakia, Ukraine, 15:00</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a><span class="st">22, 21.06, Belgium, Romania, 21:00</span></span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a><span class="st">23, 21.06, TÃ¼rkiye, Portugal, 18:00</span></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a><span class="st">24, 21.06, Georgia, Czechia, 15:00</span></span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a><span class="st">25, 25.06, Switzerland, Germany, 21:00</span></span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a><span class="st">26, 25.06, Scotland, Hungary, 21:00</span></span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a><span class="st">27, 25.06, Albania, Spain, 21:00</span></span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a><span class="st">28, 25.06, Croatia, Italy, 21:00</span></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a><span class="st">29, 25.06, England, Slovenia, 21:00</span></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a><span class="st">30, 25.06, Denmark, Serbia, 21:00</span></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a><span class="st">31, 25.06, Netherlands, Austria, 18:00</span></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a><span class="st">32, 25.06, France, Poland, 18:00</span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a><span class="st">33, 25.06, Slovakia, Romania, 18:00</span></span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a><span class="st">34, 25.06, Ukraine, Belgium, 18:00</span></span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a><span class="st">35, 25.06, Georgia, Portugal, 21:00</span></span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a><span class="st">36, 25.06, Czechia, TÃ¼rkiye, 21:00"</span></span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert CSV data to data table</span></span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>matches_raw <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="at">text =</span> csv_data)</span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>matches <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">Date=</span><span class="fu">as.Date</span>(<span class="fu">paste0</span>(<span class="st">'2024-06-'</span>, matches_raw<span class="sc">$</span>Date)), <span class="at">Time=</span><span class="fu">paste0</span>(matches_raw<span class="sc">$</span>KickoffTime, <span class="st">' CEST'</span>), <span class="at">HomeTeam=</span>matches_raw<span class="sc">$</span>Team1, <span class="at">AwayTeam=</span>matches_raw<span class="sc">$</span>Team2)</span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>results <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">num=</span><span class="cn">NULL</span>,<span class="at">Date=</span><span class="cn">NULL</span>, <span class="at">Time=</span><span class="cn">NULL</span>, <span class="at">HomeTeam=</span><span class="cn">NULL</span>, <span class="at">AwayTeam=</span><span class="cn">NULL</span>, <span class="at">Win=</span><span class="cn">NULL</span>, <span class="at">Draw=</span><span class="cn">NULL</span>, <span class="at">Lose=</span><span class="cn">NULL</span>)</span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(matches)) {</span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>  <span class="co"># i=1</span></span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cat(sprintf('## %s vs %s\n', matches[i,3], matches[i,4]))</span></span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a>  probs <span class="ot">&lt;-</span> <span class="fu">calculate_probabilities</span>(matches[i,<span class="dv">3</span>,<span class="at">drop=</span><span class="cn">TRUE</span>], matches[i,<span class="dv">4</span>,<span class="at">drop=</span><span class="cn">TRUE</span>], teams, hfit)</span>
<span id="cb16-92"><a href="#cb16-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">'Win: %.2f, Draw: %.2f, Lose: %.2f</span><span class="sc">\n</span><span class="st">'</span>, probs<span class="sc">$</span>prob_win, probs<span class="sc">$</span>prob_draw, probs<span class="sc">$</span>prob_lose))</span>
<span id="cb16-93"><a href="#cb16-93" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">=</span> <span class="fu">rbind</span>(results, <span class="fu">data.frame</span>(</span>
<span id="cb16-94"><a href="#cb16-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">Number =</span> i,</span>
<span id="cb16-95"><a href="#cb16-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">Date=</span>matches[i,<span class="dv">1</span>], </span>
<span id="cb16-96"><a href="#cb16-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">Time=</span>matches[i,<span class="dv">2</span>], </span>
<span id="cb16-97"><a href="#cb16-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">HomeTeam=</span>matches[i,<span class="dv">3</span>], </span>
<span id="cb16-98"><a href="#cb16-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">AwayTeam=</span>matches[i,<span class="dv">4</span>], </span>
<span id="cb16-99"><a href="#cb16-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">Win=</span>probs<span class="sc">$</span>prob_win, <span class="at">Draw=</span>probs<span class="sc">$</span>prob_draw, <span class="at">Lose=</span>probs<span class="sc">$</span>prob_lose))</span>
<span id="cb16-100"><a href="#cb16-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-101"><a href="#cb16-101" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Germany vs Scotland</span></span>
<span id="cb16-102"><a href="#cb16-102" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.45, Draw: 0.26, Lose: 0.29</span></span>
<span id="cb16-103"><a href="#cb16-103" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Hungary vs Switzerland</span></span>
<span id="cb16-104"><a href="#cb16-104" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.37, Draw: 0.28, Lose: 0.35</span></span>
<span id="cb16-105"><a href="#cb16-105" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Spain vs Croatia</span></span>
<span id="cb16-106"><a href="#cb16-106" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.51, Draw: 0.24, Lose: 0.26</span></span>
<span id="cb16-107"><a href="#cb16-107" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Italy vs Albania</span></span>
<span id="cb16-108"><a href="#cb16-108" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.42, Draw: 0.28, Lose: 0.30</span></span>
<span id="cb16-109"><a href="#cb16-109" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Serbia vs England</span></span>
<span id="cb16-110"><a href="#cb16-110" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.19, Draw: 0.22, Lose: 0.59</span></span>
<span id="cb16-111"><a href="#cb16-111" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Slovenia vs Denmark</span></span>
<span id="cb16-112"><a href="#cb16-112" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.38, Draw: 0.27, Lose: 0.35</span></span>
<span id="cb16-113"><a href="#cb16-113" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Poland vs Netherlands</span></span>
<span id="cb16-114"><a href="#cb16-114" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.31, Draw: 0.25, Lose: 0.44</span></span>
<span id="cb16-115"><a href="#cb16-115" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Austria vs France</span></span>
<span id="cb16-116"><a href="#cb16-116" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.35, Draw: 0.26, Lose: 0.40</span></span>
<span id="cb16-117"><a href="#cb16-117" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Belgium vs Slovakia</span></span>
<span id="cb16-118"><a href="#cb16-118" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.50, Draw: 0.26, Lose: 0.23</span></span>
<span id="cb16-119"><a href="#cb16-119" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Romania vs Ukraine</span></span>
<span id="cb16-120"><a href="#cb16-120" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.43, Draw: 0.28, Lose: 0.29</span></span>
<span id="cb16-121"><a href="#cb16-121" aria-hidden="true" tabindex="-1"></a><span class="do">## ## TÃ¼rkiye vs Georgia</span></span>
<span id="cb16-122"><a href="#cb16-122" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.42, Draw: 0.26, Lose: 0.32</span></span>
<span id="cb16-123"><a href="#cb16-123" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Portugal vs Czechia</span></span>
<span id="cb16-124"><a href="#cb16-124" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.44, Draw: 0.25, Lose: 0.31</span></span>
<span id="cb16-125"><a href="#cb16-125" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Scotland vs Switzerland</span></span>
<span id="cb16-126"><a href="#cb16-126" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.32, Draw: 0.26, Lose: 0.42</span></span>
<span id="cb16-127"><a href="#cb16-127" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Germany vs Hungary</span></span>
<span id="cb16-128"><a href="#cb16-128" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.41, Draw: 0.28, Lose: 0.32</span></span>
<span id="cb16-129"><a href="#cb16-129" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Croatia vs Albania</span></span>
<span id="cb16-130"><a href="#cb16-130" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.37, Draw: 0.29, Lose: 0.34</span></span>
<span id="cb16-131"><a href="#cb16-131" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Spain vs Italy</span></span>
<span id="cb16-132"><a href="#cb16-132" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.46, Draw: 0.24, Lose: 0.30</span></span>
<span id="cb16-133"><a href="#cb16-133" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Denmark vs England</span></span>
<span id="cb16-134"><a href="#cb16-134" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.27, Draw: 0.25, Lose: 0.49</span></span>
<span id="cb16-135"><a href="#cb16-135" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Slovenia vs Serbia</span></span>
<span id="cb16-136"><a href="#cb16-136" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.48, Draw: 0.26, Lose: 0.26</span></span>
<span id="cb16-137"><a href="#cb16-137" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Poland vs Austria</span></span>
<span id="cb16-138"><a href="#cb16-138" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.26, Draw: 0.25, Lose: 0.48</span></span>
<span id="cb16-139"><a href="#cb16-139" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Netherlands vs France</span></span>
<span id="cb16-140"><a href="#cb16-140" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.30, Draw: 0.23, Lose: 0.47</span></span>
<span id="cb16-141"><a href="#cb16-141" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Slovakia vs Ukraine</span></span>
<span id="cb16-142"><a href="#cb16-142" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.35, Draw: 0.29, Lose: 0.36</span></span>
<span id="cb16-143"><a href="#cb16-143" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Belgium vs Romania</span></span>
<span id="cb16-144"><a href="#cb16-144" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.42, Draw: 0.28, Lose: 0.30</span></span>
<span id="cb16-145"><a href="#cb16-145" aria-hidden="true" tabindex="-1"></a><span class="do">## ## TÃ¼rkiye vs Portugal</span></span>
<span id="cb16-146"><a href="#cb16-146" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.24, Draw: 0.23, Lose: 0.53</span></span>
<span id="cb16-147"><a href="#cb16-147" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Georgia vs Czechia</span></span>
<span id="cb16-148"><a href="#cb16-148" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.25, Draw: 0.27, Lose: 0.47</span></span>
<span id="cb16-149"><a href="#cb16-149" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Switzerland vs Germany</span></span>
<span id="cb16-150"><a href="#cb16-150" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.35, Draw: 0.25, Lose: 0.40</span></span>
<span id="cb16-151"><a href="#cb16-151" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Scotland vs Hungary</span></span>
<span id="cb16-152"><a href="#cb16-152" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.30, Draw: 0.28, Lose: 0.42</span></span>
<span id="cb16-153"><a href="#cb16-153" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Albania vs Spain</span></span>
<span id="cb16-154"><a href="#cb16-154" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.25, Draw: 0.23, Lose: 0.51</span></span>
<span id="cb16-155"><a href="#cb16-155" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Croatia vs Italy</span></span>
<span id="cb16-156"><a href="#cb16-156" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.31, Draw: 0.28, Lose: 0.42</span></span>
<span id="cb16-157"><a href="#cb16-157" aria-hidden="true" tabindex="-1"></a><span class="do">## ## England vs Slovenia</span></span>
<span id="cb16-158"><a href="#cb16-158" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.47, Draw: 0.26, Lose: 0.27</span></span>
<span id="cb16-159"><a href="#cb16-159" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Denmark vs Serbia</span></span>
<span id="cb16-160"><a href="#cb16-160" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.46, Draw: 0.26, Lose: 0.27</span></span>
<span id="cb16-161"><a href="#cb16-161" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Netherlands vs Austria</span></span>
<span id="cb16-162"><a href="#cb16-162" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.32, Draw: 0.24, Lose: 0.44</span></span>
<span id="cb16-163"><a href="#cb16-163" aria-hidden="true" tabindex="-1"></a><span class="do">## ## France vs Poland</span></span>
<span id="cb16-164"><a href="#cb16-164" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.50, Draw: 0.24, Lose: 0.26</span></span>
<span id="cb16-165"><a href="#cb16-165" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Slovakia vs Romania</span></span>
<span id="cb16-166"><a href="#cb16-166" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.28, Draw: 0.27, Lose: 0.45</span></span>
<span id="cb16-167"><a href="#cb16-167" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Ukraine vs Belgium</span></span>
<span id="cb16-168"><a href="#cb16-168" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.25, Draw: 0.24, Lose: 0.51</span></span>
<span id="cb16-169"><a href="#cb16-169" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Georgia vs Portugal</span></span>
<span id="cb16-170"><a href="#cb16-170" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.21, Draw: 0.22, Lose: 0.56</span></span>
<span id="cb16-171"><a href="#cb16-171" aria-hidden="true" tabindex="-1"></a><span class="do">## ## Czechia vs TÃ¼rkiye</span></span>
<span id="cb16-172"><a href="#cb16-172" aria-hidden="true" tabindex="-1"></a><span class="do">## Win: 0.43, Draw: 0.27, Lose: 0.31</span></span>
<span id="cb16-173"><a href="#cb16-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-174"><a href="#cb16-174" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the summary table with links</span></span>
<span id="cb16-175"><a href="#cb16-175" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(results, <span class="at">caption =</span> <span class="st">"Probabilities of Match Outcomes"</span>, <span class="at">escape =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Probabilities of Match Outcomes</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Number</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Date</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Time</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">HomeTeam</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">AwayTeam</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Win</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Draw</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Lose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">2024-06-14</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Scotland</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.29</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">2024-06-15</td>
<td style="text-align: left;">15:00 CEST</td>
<td style="text-align: left;">Hungary</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.35</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">2024-06-15</td>
<td style="text-align: left;">18:00 CEST</td>
<td style="text-align: left;">Spain</td>
<td style="text-align: left;">Croatia</td>
<td style="text-align: right;">0.51</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.26</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">2024-06-15</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Italy</td>
<td style="text-align: left;">Albania</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: left;">2024-06-16</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Serbia</td>
<td style="text-align: left;">England</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.59</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">2024-06-16</td>
<td style="text-align: left;">18:00 CEST</td>
<td style="text-align: left;">Slovenia</td>
<td style="text-align: left;">Denmark</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.35</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: left;">2024-06-16</td>
<td style="text-align: left;">15:00 CEST</td>
<td style="text-align: left;">Poland</td>
<td style="text-align: left;">Netherlands</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.44</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">2024-06-17</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Austria</td>
<td style="text-align: left;">France</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.40</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: left;">2024-06-17</td>
<td style="text-align: left;">18:00 CEST</td>
<td style="text-align: left;">Belgium</td>
<td style="text-align: left;">Slovakia</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.23</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: left;">2024-06-17</td>
<td style="text-align: left;">15:00 CEST</td>
<td style="text-align: left;">Romania</td>
<td style="text-align: left;">Ukraine</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.29</td>
</tr>
<tr class="odd">
<td style="text-align: right;">11</td>
<td style="text-align: left;">2024-06-18</td>
<td style="text-align: left;">18:00 CEST</td>
<td style="text-align: left;">TÃ¼rkiye</td>
<td style="text-align: left;">Georgia</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.32</td>
</tr>
<tr class="even">
<td style="text-align: right;">12</td>
<td style="text-align: left;">2024-06-18</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Portugal</td>
<td style="text-align: left;">Czechia</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.31</td>
</tr>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: left;">2024-06-19</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Scotland</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.42</td>
</tr>
<tr class="even">
<td style="text-align: right;">14</td>
<td style="text-align: left;">2024-06-19</td>
<td style="text-align: left;">18:00 CEST</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: left;">Hungary</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.32</td>
</tr>
<tr class="odd">
<td style="text-align: right;">15</td>
<td style="text-align: left;">2024-06-19</td>
<td style="text-align: left;">15:00 CEST</td>
<td style="text-align: left;">Croatia</td>
<td style="text-align: left;">Albania</td>
<td style="text-align: right;">0.37</td>
<td style="text-align: right;">0.29</td>
<td style="text-align: right;">0.34</td>
</tr>
<tr class="even">
<td style="text-align: right;">16</td>
<td style="text-align: left;">2024-06-19</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Spain</td>
<td style="text-align: left;">Italy</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">17</td>
<td style="text-align: left;">2024-06-20</td>
<td style="text-align: left;">18:00 CEST</td>
<td style="text-align: left;">Denmark</td>
<td style="text-align: left;">England</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.49</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: left;">2024-06-20</td>
<td style="text-align: left;">15:00 CEST</td>
<td style="text-align: left;">Slovenia</td>
<td style="text-align: left;">Serbia</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">19</td>
<td style="text-align: left;">2024-06-20</td>
<td style="text-align: left;">18:00 CEST</td>
<td style="text-align: left;">Poland</td>
<td style="text-align: left;">Austria</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.48</td>
</tr>
<tr class="even">
<td style="text-align: right;">20</td>
<td style="text-align: left;">2024-06-20</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Netherlands</td>
<td style="text-align: left;">France</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="odd">
<td style="text-align: right;">21</td>
<td style="text-align: left;">2024-06-21</td>
<td style="text-align: left;">15:00 CEST</td>
<td style="text-align: left;">Slovakia</td>
<td style="text-align: left;">Ukraine</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">0.29</td>
<td style="text-align: right;">0.36</td>
</tr>
<tr class="even">
<td style="text-align: right;">22</td>
<td style="text-align: left;">2024-06-21</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Belgium</td>
<td style="text-align: left;">Romania</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">23</td>
<td style="text-align: left;">2024-06-21</td>
<td style="text-align: left;">18:00 CEST</td>
<td style="text-align: left;">TÃ¼rkiye</td>
<td style="text-align: left;">Portugal</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.53</td>
</tr>
<tr class="even">
<td style="text-align: right;">24</td>
<td style="text-align: left;">2024-06-21</td>
<td style="text-align: left;">15:00 CEST</td>
<td style="text-align: left;">Georgia</td>
<td style="text-align: left;">Czechia</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="odd">
<td style="text-align: right;">25</td>
<td style="text-align: left;">2024-06-25</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Switzerland</td>
<td style="text-align: left;">Germany</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.40</td>
</tr>
<tr class="even">
<td style="text-align: right;">26</td>
<td style="text-align: left;">2024-06-25</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Scotland</td>
<td style="text-align: left;">Hungary</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.42</td>
</tr>
<tr class="odd">
<td style="text-align: right;">27</td>
<td style="text-align: left;">2024-06-25</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Albania</td>
<td style="text-align: left;">Spain</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.51</td>
</tr>
<tr class="even">
<td style="text-align: right;">28</td>
<td style="text-align: left;">2024-06-25</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Croatia</td>
<td style="text-align: left;">Italy</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.42</td>
</tr>
<tr class="odd">
<td style="text-align: right;">29</td>
<td style="text-align: left;">2024-06-25</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">England</td>
<td style="text-align: left;">Slovenia</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.27</td>
</tr>
<tr class="even">
<td style="text-align: right;">30</td>
<td style="text-align: left;">2024-06-25</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Denmark</td>
<td style="text-align: left;">Serbia</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.27</td>
</tr>
<tr class="odd">
<td style="text-align: right;">31</td>
<td style="text-align: left;">2024-06-25</td>
<td style="text-align: left;">18:00 CEST</td>
<td style="text-align: left;">Netherlands</td>
<td style="text-align: left;">Austria</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.44</td>
</tr>
<tr class="even">
<td style="text-align: right;">32</td>
<td style="text-align: left;">2024-06-25</td>
<td style="text-align: left;">18:00 CEST</td>
<td style="text-align: left;">France</td>
<td style="text-align: left;">Poland</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.26</td>
</tr>
<tr class="odd">
<td style="text-align: right;">33</td>
<td style="text-align: left;">2024-06-25</td>
<td style="text-align: left;">18:00 CEST</td>
<td style="text-align: left;">Slovakia</td>
<td style="text-align: left;">Romania</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.45</td>
</tr>
<tr class="even">
<td style="text-align: right;">34</td>
<td style="text-align: left;">2024-06-25</td>
<td style="text-align: left;">18:00 CEST</td>
<td style="text-align: left;">Ukraine</td>
<td style="text-align: left;">Belgium</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.51</td>
</tr>
<tr class="odd">
<td style="text-align: right;">35</td>
<td style="text-align: left;">2024-06-25</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Georgia</td>
<td style="text-align: left;">Portugal</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.56</td>
</tr>
<tr class="even">
<td style="text-align: right;">36</td>
<td style="text-align: left;">2024-06-25</td>
<td style="text-align: left;">21:00 CEST</td>
<td style="text-align: left;">Czechia</td>
<td style="text-align: left;">TÃ¼rkiye</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.31</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
<section id="details-on-individual-games" class="level2">
<h2 class="anchored" data-anchor-id="details-on-individual-games">Details on individual games</h2>
<section id="goal-distributions" class="level3">
<h3 class="anchored" data-anchor-id="goal-distributions">Goal Distributions</h3>
</section>
</section>
<section id="germany-vs-scotland" class="level2">
<h2 class="anchored" data-anchor-id="germany-vs-scotland">1 Germany vs Scotland</h2>
<p><img src="euro24_files/figure-html/individual_plots-1.png" class="img-fluid" width="672"></p>
</section>
<section id="hungary-vs-switzerland" class="level2">
<h2 class="anchored" data-anchor-id="hungary-vs-switzerland">2 Hungary vs Switzerland</h2>
<p><img src="euro24_files/figure-html/individual_plots-2.png" class="img-fluid" width="672"></p>
</section>
<section id="spain-vs-croatia" class="level2">
<h2 class="anchored" data-anchor-id="spain-vs-croatia">3 Spain vs Croatia</h2>
<p><img src="euro24_files/figure-html/individual_plots-3.png" class="img-fluid" width="672"></p>
</section>
<section id="italy-vs-albania" class="level2">
<h2 class="anchored" data-anchor-id="italy-vs-albania">4 Italy vs Albania</h2>
<p><img src="euro24_files/figure-html/individual_plots-4.png" class="img-fluid" width="672"></p>
</section>
<section id="serbia-vs-england" class="level2">
<h2 class="anchored" data-anchor-id="serbia-vs-england">5 Serbia vs England</h2>
<p><img src="euro24_files/figure-html/individual_plots-5.png" class="img-fluid" width="672"></p>
</section>
<section id="slovenia-vs-denmark" class="level2">
<h2 class="anchored" data-anchor-id="slovenia-vs-denmark">6 Slovenia vs Denmark</h2>
<p><img src="euro24_files/figure-html/individual_plots-6.png" class="img-fluid" width="672"></p>
</section>
<section id="poland-vs-netherlands" class="level2">
<h2 class="anchored" data-anchor-id="poland-vs-netherlands">7 Poland vs Netherlands</h2>
<p><img src="euro24_files/figure-html/individual_plots-7.png" class="img-fluid" width="672"></p>
</section>
<section id="austria-vs-france" class="level2">
<h2 class="anchored" data-anchor-id="austria-vs-france">8 Austria vs France</h2>
<p><img src="euro24_files/figure-html/individual_plots-8.png" class="img-fluid" width="672"></p>
</section>
<section id="belgium-vs-slovakia" class="level2">
<h2 class="anchored" data-anchor-id="belgium-vs-slovakia">9 Belgium vs Slovakia</h2>
<p><img src="euro24_files/figure-html/individual_plots-9.png" class="img-fluid" width="672"></p>
</section>
<section id="romania-vs-ukraine" class="level2">
<h2 class="anchored" data-anchor-id="romania-vs-ukraine">10 Romania vs Ukraine</h2>
<p><img src="euro24_files/figure-html/individual_plots-10.png" class="img-fluid" width="672"></p>
</section>
<section id="tÃ¼rkiye-vs-georgia" class="level2">
<h2 class="anchored" data-anchor-id="tÃ¼rkiye-vs-georgia">11 TÃ¼rkiye vs Georgia</h2>
<p><img src="euro24_files/figure-html/individual_plots-11.png" class="img-fluid" width="672"></p>
</section>
<section id="portugal-vs-czechia" class="level2">
<h2 class="anchored" data-anchor-id="portugal-vs-czechia">12 Portugal vs Czechia</h2>
<p><img src="euro24_files/figure-html/individual_plots-12.png" class="img-fluid" width="672"></p>
</section>
<section id="scotland-vs-switzerland" class="level2">
<h2 class="anchored" data-anchor-id="scotland-vs-switzerland">13 Scotland vs Switzerland</h2>
<p><img src="euro24_files/figure-html/individual_plots-13.png" class="img-fluid" width="672"></p>
</section>
<section id="germany-vs-hungary" class="level2">
<h2 class="anchored" data-anchor-id="germany-vs-hungary">14 Germany vs Hungary</h2>
<p><img src="euro24_files/figure-html/individual_plots-14.png" class="img-fluid" width="672"></p>
</section>
<section id="croatia-vs-albania" class="level2">
<h2 class="anchored" data-anchor-id="croatia-vs-albania">15 Croatia vs Albania</h2>
<p><img src="euro24_files/figure-html/individual_plots-15.png" class="img-fluid" width="672"></p>
</section>
<section id="spain-vs-italy" class="level2">
<h2 class="anchored" data-anchor-id="spain-vs-italy">16 Spain vs Italy</h2>
<p><img src="euro24_files/figure-html/individual_plots-16.png" class="img-fluid" width="672"></p>
</section>
<section id="denmark-vs-england" class="level2">
<h2 class="anchored" data-anchor-id="denmark-vs-england">17 Denmark vs England</h2>
<p><img src="euro24_files/figure-html/individual_plots-17.png" class="img-fluid" width="672"></p>
</section>
<section id="slovenia-vs-serbia" class="level2">
<h2 class="anchored" data-anchor-id="slovenia-vs-serbia">18 Slovenia vs Serbia</h2>
<p><img src="euro24_files/figure-html/individual_plots-18.png" class="img-fluid" width="672"></p>
</section>
<section id="poland-vs-austria" class="level2">
<h2 class="anchored" data-anchor-id="poland-vs-austria">19 Poland vs Austria</h2>
<p><img src="euro24_files/figure-html/individual_plots-19.png" class="img-fluid" width="672"></p>
</section>
<section id="netherlands-vs-france" class="level2">
<h2 class="anchored" data-anchor-id="netherlands-vs-france">20 Netherlands vs France</h2>
<p><img src="euro24_files/figure-html/individual_plots-20.png" class="img-fluid" width="672"></p>
</section>
<section id="slovakia-vs-ukraine" class="level2">
<h2 class="anchored" data-anchor-id="slovakia-vs-ukraine">21 Slovakia vs Ukraine</h2>
<p><img src="euro24_files/figure-html/individual_plots-21.png" class="img-fluid" width="672"></p>
</section>
<section id="belgium-vs-romania" class="level2">
<h2 class="anchored" data-anchor-id="belgium-vs-romania">22 Belgium vs Romania</h2>
<p><img src="euro24_files/figure-html/individual_plots-22.png" class="img-fluid" width="672"></p>
</section>
<section id="tÃ¼rkiye-vs-portugal" class="level2">
<h2 class="anchored" data-anchor-id="tÃ¼rkiye-vs-portugal">23 TÃ¼rkiye vs Portugal</h2>
<p><img src="euro24_files/figure-html/individual_plots-23.png" class="img-fluid" width="672"></p>
</section>
<section id="georgia-vs-czechia" class="level2">
<h2 class="anchored" data-anchor-id="georgia-vs-czechia">24 Georgia vs Czechia</h2>
<p><img src="euro24_files/figure-html/individual_plots-24.png" class="img-fluid" width="672"></p>
</section>
<section id="switzerland-vs-germany" class="level2">
<h2 class="anchored" data-anchor-id="switzerland-vs-germany">25 Switzerland vs Germany</h2>
<p><img src="euro24_files/figure-html/individual_plots-25.png" class="img-fluid" width="672"></p>
</section>
<section id="scotland-vs-hungary" class="level2">
<h2 class="anchored" data-anchor-id="scotland-vs-hungary">26 Scotland vs Hungary</h2>
<p><img src="euro24_files/figure-html/individual_plots-26.png" class="img-fluid" width="672"></p>
</section>
<section id="albania-vs-spain" class="level2">
<h2 class="anchored" data-anchor-id="albania-vs-spain">27 Albania vs Spain</h2>
<p><img src="euro24_files/figure-html/individual_plots-27.png" class="img-fluid" width="672"></p>
</section>
<section id="croatia-vs-italy" class="level2">
<h2 class="anchored" data-anchor-id="croatia-vs-italy">28 Croatia vs Italy</h2>
<p><img src="euro24_files/figure-html/individual_plots-28.png" class="img-fluid" width="672"></p>
</section>
<section id="england-vs-slovenia" class="level2">
<h2 class="anchored" data-anchor-id="england-vs-slovenia">29 England vs Slovenia</h2>
<p><img src="euro24_files/figure-html/individual_plots-29.png" class="img-fluid" width="672"></p>
</section>
<section id="denmark-vs-serbia" class="level2">
<h2 class="anchored" data-anchor-id="denmark-vs-serbia">30 Denmark vs Serbia</h2>
<p><img src="euro24_files/figure-html/individual_plots-30.png" class="img-fluid" width="672"></p>
</section>
<section id="netherlands-vs-austria" class="level2">
<h2 class="anchored" data-anchor-id="netherlands-vs-austria">31 Netherlands vs Austria</h2>
<p><img src="euro24_files/figure-html/individual_plots-31.png" class="img-fluid" width="672"></p>
</section>
<section id="france-vs-poland" class="level2">
<h2 class="anchored" data-anchor-id="france-vs-poland">32 France vs Poland</h2>
<p><img src="euro24_files/figure-html/individual_plots-32.png" class="img-fluid" width="672"></p>
</section>
<section id="slovakia-vs-romania" class="level2">
<h2 class="anchored" data-anchor-id="slovakia-vs-romania">33 Slovakia vs Romania</h2>
<p><img src="euro24_files/figure-html/individual_plots-33.png" class="img-fluid" width="672"></p>
</section>
<section id="ukraine-vs-belgium" class="level2">
<h2 class="anchored" data-anchor-id="ukraine-vs-belgium">34 Ukraine vs Belgium</h2>
<p><img src="euro24_files/figure-html/individual_plots-34.png" class="img-fluid" width="672"></p>
</section>
<section id="georgia-vs-portugal" class="level2">
<h2 class="anchored" data-anchor-id="georgia-vs-portugal">35 Georgia vs Portugal</h2>
<p><img src="euro24_files/figure-html/individual_plots-35.png" class="img-fluid" width="672"></p>
</section>
<section id="czechia-vs-tÃ¼rkiye" class="level2">
<h2 class="anchored" data-anchor-id="czechia-vs-tÃ¼rkiye">36 Czechia vs TÃ¼rkiye</h2>
<p><img src="euro24_files/figure-html/individual_plots-36.png" class="img-fluid" width="672"></p>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb17" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Bayes is coming home - Predicting the Euro 2024 with Stan"</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Oliver DÃ¼rr"</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-title: "Table of Contents"</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 6</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 3</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">    mathjax: true</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">  # pdf:</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">  #   toc: true</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">  #   toc-title: "Table of Contents"</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">  - webr</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="in">  library(tidyverse)</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="in">  library(kableExtra)</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>The Euro 2024 âš½ is a nice showcase of Bayesian Statistics. In Bayesian statistics, probabilities are seen as a degree of belief, which fits well with the nature of football. Almost everyone has beliefs about the strengths and weaknesses of the teams before seeing any games (based on historical data) and then updates these beliefs as new data comes in (games have been played).</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prediction based on the Historical Data</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>We load the matches prior to the Euro 2024, see <span class="ot">&lt;https://github.com/oduerr/da/blob/master/stan/Euro24/Euro_Data.md&gt;</span> how to get the data. Note the limitations of using historic; for example, Germany only started finding their form shortly before Euro 2024.</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="fu">## Loading the data</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load_data, echo=FALSE, eval=TRUE, collapse=TRUE}</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="in"># Uncomment the following line to read the data for the Euro 24</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="in">data = read.csv('~/Documents/GitHub/da/stan/Euro24/games_before_euro24.csv', stringsAsFactors = FALSE)</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="in">data = data[,1:4]</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(data) = c('Home','score1', 'score2', 'Away')</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="in">#kable(data[1:3,])</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>Loaded <span class="in">`r nrow(data)`</span> games with <span class="in">`r length(unique(c(data$Home, data$Away)))`</span> teams.</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>::: {.callout-caution collapse="true"}</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="fu">## Expand To Learn How to set up the data for Stan</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preparing the data for Stan</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="in">```{r preparing_for_stan}</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a><span class="in">#Some R-Magic to convert the team names to numbers, no need to understand this</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a><span class="in">ng = nrow(data)</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a><span class="in">teams = unique(data$Home)</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a><span class="in">nt = length(teams)</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a><span class="in">ht = unlist(sapply(1:ng, function(g) which(teams == data$Home[g])))</span></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a><span class="in">at = unlist(sapply(1:ng, function(g) which(teams == data$Away[g])))</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a><span class="in">np=1 #Number games leaving out for prediction</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a><span class="in">ngob = ng-np #ngames obsered ngob = number of games to fit</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a><span class="in">#print(paste0("Using the first ", ngob, " games to fit the model and ", np, " games to predict.", "Num teams ",  length(teams)))</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a><span class="in">my_data = list(</span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a><span class="in">  nt = nt, </span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a><span class="in">  ng = ngob,</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a><span class="in">  ht = ht[1:ngob], </span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a><span class="in">  at = at[1:ngob], </span></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a><span class="in">  s1 = data$score1[1:ngob],</span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a><span class="in">  s2 = data$score2[1:ngob],</span></span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a><span class="in">  np = np,</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a><span class="in">  htnew = ht[(ngob+1):ng],</span></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a><span class="in">  atnew = at[(ngob+1):ng]</span></span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>Using the first <span class="in">`r ngob`</span> games to fit the model and <span class="in">`r np`</span> games to predict. In total we have <span class="in">`r length(teams)`</span> teams.</span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a><span class="fu">## A Model for the goals scored ðŸ¥…</span></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>We will assume that the number of goals scored by the home team $s_1$ and the away team $s_2$ follows a Poisson distribution. This has been shown to be a good model for the number of goals scored in a football match. We model the rate parameter $\theta$ of the Poisson distribution, related to the attack and defense strengths of the teams, as follows:</span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a><span class="in">    $$s_1 \sim \text{Pois}(\theta_1) \quad\text{goals scored by the home team}$$</span></span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a><span class="in">    $$</span></span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a><span class="in">    s_2 \sim \text{Pois}(\theta_2) \quad\text{goals scored by the away team}</span></span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a><span class="in">    $$ </span></span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a>This is equivalent to performing two separate Poisson regressions, one for each team.</span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a>We assume that:</span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a><span class="in">    $$</span></span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a><span class="in">    \theta_1 = \exp(\text{home} + \text{att}\text{ht} - \text{def}\text{at})</span></span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a><span class="in">    $$</span></span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a><span class="in">    $$</span></span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a><span class="in">    \theta_2 = \exp(\text{att}\text{at} - \text{def}\text{ht})</span></span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a><span class="in">    $$</span></span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a>Since there is no home advantage in the Euro (except for Germany), we set $\text{home} = 0$.</span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-102"><a href="#cb17-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-103"><a href="#cb17-103" aria-hidden="true" tabindex="-1"></a><span class="fu">### Prior for the attack and defence strength</span></span>
<span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a>In Bayesian statistics, we further need to specify a prior for the parameters (our degree of believe in the attack and defense abilities before seeing any data). For that we use a  hierarchical model with correlated parameters. Other models are investigated at <span class="ot">&lt;https://github.com/oduerr/da/blob/master/stan/football/Correlated.md&gt;</span> for the English Premier League 2019/2020 season where the hiearchical model have been especially successfull. The model is adopted from the <span class="co">[</span><span class="ot">blog_post</span><span class="co">](https://github.com/MaggieLieu/STAN_tutorials/tree/master/Hierarchical)</span> and the <span class="co">[</span><span class="ot">paper</span><span class="co">](https://discovery.ucl.ac.uk/id/eprint/16040/1/16040.pdf)</span>. The model is written in the probabilistic programming language Stan and can be found at <span class="ot">&lt;https://github.com/oduerr/da/blob/master/website/Euro24/hier_model_cor.stan&gt;</span>.</span>
<span id="cb17-105"><a href="#cb17-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-106"><a href="#cb17-106" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conditioning on the data / Fitting the model</span></span>
<span id="cb17-107"><a href="#cb17-107" aria-hidden="true" tabindex="-1"></a>After we state the model we fit the model to the data, or in Bayesian parlance, we update our degree of belief after seeing the data. </span>
<span id="cb17-108"><a href="#cb17-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-109"><a href="#cb17-109" aria-hidden="true" tabindex="-1"></a>::: {.callout-caution collapse="true"}</span>
<span id="cb17-110"><a href="#cb17-110" aria-hidden="true" tabindex="-1"></a><span class="fu">## Expand MCMC sampling with Stan</span></span>
<span id="cb17-111"><a href="#cb17-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-112"><a href="#cb17-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-113"><a href="#cb17-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-114"><a href="#cb17-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, collapse=TRUE, warning=FALSE, fig.width=10, fig.height=3}</span></span>
<span id="cb17-115"><a href="#cb17-115" aria-hidden="true" tabindex="-1"></a><span class="in">library(cmdstanr)</span></span>
<span id="cb17-116"><a href="#cb17-116" aria-hidden="true" tabindex="-1"></a><span class="in">options(mc.cores = parallel::detectCores())</span></span>
<span id="cb17-117"><a href="#cb17-117" aria-hidden="true" tabindex="-1"></a><span class="in">hmodel &lt;- cmdstan_model('~/Documents/GitHub/da/website/Euro24/hier_model_cor.stan') </span></span>
<span id="cb17-118"><a href="#cb17-118" aria-hidden="true" tabindex="-1"></a><span class="in">hfit = hmodel$sample(data = my_data)</span></span>
<span id="cb17-119"><a href="#cb17-119" aria-hidden="true" tabindex="-1"></a><span class="in">p1 = bayesplot::mcmc_rhat_hist(bayesplot::rhat(hfit))</span></span>
<span id="cb17-120"><a href="#cb17-120" aria-hidden="true" tabindex="-1"></a><span class="in">p2 = bayesplot::mcmc_neff_hist(bayesplot::neff_ratio(hfit))</span></span>
<span id="cb17-121"><a href="#cb17-121" aria-hidden="true" tabindex="-1"></a><span class="in">ggpubr::ggarrange(p1, p2, ncol=2)</span></span>
<span id="cb17-122"><a href="#cb17-122" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-123"><a href="#cb17-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-124"><a href="#cb17-124" aria-hidden="true" tabindex="-1"></a>The fitting of the model is good, as the Rhat values are close to 1 and we have no divergent transitions. The effective sample size is also good. </span>
<span id="cb17-125"><a href="#cb17-125" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb17-126"><a href="#cb17-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-127"><a href="#cb17-127" aria-hidden="true" tabindex="-1"></a><span class="fu">## The fitted model</span></span>
<span id="cb17-128"><a href="#cb17-128" aria-hidden="true" tabindex="-1"></a>We plot the means of the attack and defense strengths of the teams. Shown are the mean values along with the 25% and 75% quantiles. There is considerable uncertainty in the strengths of the teams, but thatâ€™s the nature of the game.</span>
<span id="cb17-129"><a href="#cb17-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-130"><a href="#cb17-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-131"><a href="#cb17-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-132"><a href="#cb17-132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, collapse=TRUE, warning=FALSE, fig.width=7, fig.height=7}</span></span>
<span id="cb17-133"><a href="#cb17-133" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb17-134"><a href="#cb17-134" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidybayes)</span></span>
<span id="cb17-135"><a href="#cb17-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-136"><a href="#cb17-136" aria-hidden="true" tabindex="-1"></a><span class="in"># Step 1: Gather draws and calculate summary statistics with credible intervals</span></span>
<span id="cb17-137"><a href="#cb17-137" aria-hidden="true" tabindex="-1"></a><span class="in">d = hfit %&gt;%</span></span>
<span id="cb17-138"><a href="#cb17-138" aria-hidden="true" tabindex="-1"></a><span class="in">  tidybayes::gather_draws(A[i, j]) %&gt;%</span></span>
<span id="cb17-139"><a href="#cb17-139" aria-hidden="true" tabindex="-1"></a><span class="in">  group_by(i, j) %&gt;%</span></span>
<span id="cb17-140"><a href="#cb17-140" aria-hidden="true" tabindex="-1"></a><span class="in">  summarise(</span></span>
<span id="cb17-141"><a href="#cb17-141" aria-hidden="true" tabindex="-1"></a><span class="in">    average_value = mean(.value),</span></span>
<span id="cb17-142"><a href="#cb17-142" aria-hidden="true" tabindex="-1"></a><span class="in">    lower = quantile(.value, 0.25),  # Lower bound </span></span>
<span id="cb17-143"><a href="#cb17-143" aria-hidden="true" tabindex="-1"></a><span class="in">    upper = quantile(.value, 0.75),  # Upper bound </span></span>
<span id="cb17-144"><a href="#cb17-144" aria-hidden="true" tabindex="-1"></a><span class="in">    .groups = "drop"</span></span>
<span id="cb17-145"><a href="#cb17-145" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb17-146"><a href="#cb17-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-147"><a href="#cb17-147" aria-hidden="true" tabindex="-1"></a><span class="in"># Step 2: Create a matrix of the average values</span></span>
<span id="cb17-148"><a href="#cb17-148" aria-hidden="true" tabindex="-1"></a><span class="in">A = xtabs(average_value ~ i + j, data = d)</span></span>
<span id="cb17-149"><a href="#cb17-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-150"><a href="#cb17-150" aria-hidden="true" tabindex="-1"></a><span class="in"># Step 3: Plot the average values</span></span>
<span id="cb17-151"><a href="#cb17-151" aria-hidden="true" tabindex="-1"></a><span class="in">plot(A[1,], A[2,], pch=20, xlab='Attack', ylab='Defence', main='Attack vs Defence')</span></span>
<span id="cb17-152"><a href="#cb17-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-153"><a href="#cb17-153" aria-hidden="true" tabindex="-1"></a><span class="in"># Step 4: Add team labels</span></span>
<span id="cb17-154"><a href="#cb17-154" aria-hidden="true" tabindex="-1"></a><span class="in">text(A[1,], A[2,], labels=teams, cex=0.7, adj=c(-0.05, -0.8))</span></span>
<span id="cb17-155"><a href="#cb17-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-156"><a href="#cb17-156" aria-hidden="true" tabindex="-1"></a><span class="in"># Step 5: Add error bars for 66% credibility intervals</span></span>
<span id="cb17-157"><a href="#cb17-157" aria-hidden="true" tabindex="-1"></a><span class="in"># Reshape data for plotting</span></span>
<span id="cb17-158"><a href="#cb17-158" aria-hidden="true" tabindex="-1"></a><span class="in">d_wide &lt;- d %&gt;% spread(key = j, value = average_value)</span></span>
<span id="cb17-159"><a href="#cb17-159" aria-hidden="true" tabindex="-1"></a><span class="in">d_lower &lt;- d %&gt;% spread(key = j, value = lower)</span></span>
<span id="cb17-160"><a href="#cb17-160" aria-hidden="true" tabindex="-1"></a><span class="in">d_upper &lt;- d %&gt;% spread(key = j, value = upper)</span></span>
<span id="cb17-161"><a href="#cb17-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-162"><a href="#cb17-162" aria-hidden="true" tabindex="-1"></a><span class="in"># Convert to matrices for easier plotting</span></span>
<span id="cb17-163"><a href="#cb17-163" aria-hidden="true" tabindex="-1"></a><span class="in">A_lower &lt;- xtabs(lower ~ i + j, data = d)</span></span>
<span id="cb17-164"><a href="#cb17-164" aria-hidden="true" tabindex="-1"></a><span class="in">A_upper &lt;- xtabs(upper ~ i + j, data = d)</span></span>
<span id="cb17-165"><a href="#cb17-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-166"><a href="#cb17-166" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot vertical error bars</span></span>
<span id="cb17-167"><a href="#cb17-167" aria-hidden="true" tabindex="-1"></a><span class="in">arrows(A[1,], A_lower[2,], A[1,], A_upper[2,], angle=90, code=3, length=0.05, col="lightblue", alpha=0.5)</span></span>
<span id="cb17-168"><a href="#cb17-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-169"><a href="#cb17-169" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot horizontal error bars</span></span>
<span id="cb17-170"><a href="#cb17-170" aria-hidden="true" tabindex="-1"></a><span class="in">arrows(A_lower[1,], A[2,], A_upper[1,], A[2,], angle=90, code=3, length=0.05, col="lightblue")</span></span>
<span id="cb17-171"><a href="#cb17-171" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-172"><a href="#cb17-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-173"><a href="#cb17-173" aria-hidden="true" tabindex="-1"></a>::: {.callout-caution collapse="false"}</span>
<span id="cb17-174"><a href="#cb17-174" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example Prediction Germany vs Scotland</span></span>
<span id="cb17-175"><a href="#cb17-175" aria-hidden="true" tabindex="-1"></a>The opening game of Euro 2024 was Germany vs. Scotland. In the plots below, we show the posterior probabilities for the attack and defense strengths of the teams. </span>
<span id="cb17-176"><a href="#cb17-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-177"><a href="#cb17-177" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, collapse=TRUE, warning=FALSE, fig.width=7, fig.height=3}</span></span>
<span id="cb17-178"><a href="#cb17-178" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb17-179"><a href="#cb17-179" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyr)</span></span>
<span id="cb17-180"><a href="#cb17-180" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb17-181"><a href="#cb17-181" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidybayes)</span></span>
<span id="cb17-182"><a href="#cb17-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-183"><a href="#cb17-183" aria-hidden="true" tabindex="-1"></a><span class="in"># Function to calculate probabilities for a pairing</span></span>
<span id="cb17-184"><a href="#cb17-184" aria-hidden="true" tabindex="-1"></a><span class="in">id1 &lt;- which(teams == 'Germany')</span></span>
<span id="cb17-185"><a href="#cb17-185" aria-hidden="true" tabindex="-1"></a><span class="in">id2 &lt;- which(teams == 'Scotland')</span></span>
<span id="cb17-186"><a href="#cb17-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-187"><a href="#cb17-187" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract posterior distributions for Attack and Defense</span></span>
<span id="cb17-188"><a href="#cb17-188" aria-hidden="true" tabindex="-1"></a><span class="in">attack_germany &lt;- hfit %&gt;% tidybayes::spread_draws(A[i, j]) %&gt;% filter(j == id1, i == 1) %&gt;% select(A)</span></span>
<span id="cb17-189"><a href="#cb17-189" aria-hidden="true" tabindex="-1"></a><span class="in">attack_scotland &lt;- hfit %&gt;% tidybayes::spread_draws(A[i, j]) %&gt;% filter(j == id2, i == 1) %&gt;% select(A)</span></span>
<span id="cb17-190"><a href="#cb17-190" aria-hidden="true" tabindex="-1"></a><span class="in">defense_germany &lt;- hfit %&gt;% tidybayes::spread_draws(A[i, j]) %&gt;% filter(j == id1, i == 2) %&gt;% select(A)</span></span>
<span id="cb17-191"><a href="#cb17-191" aria-hidden="true" tabindex="-1"></a><span class="in">defense_scotland &lt;- hfit %&gt;% tidybayes::spread_draws(A[i, j]) %&gt;% filter(j == id2, i == 2) %&gt;% select(A)</span></span>
<span id="cb17-192"><a href="#cb17-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-193"><a href="#cb17-193" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine data into a tidy data frame</span></span>
<span id="cb17-194"><a href="#cb17-194" aria-hidden="true" tabindex="-1"></a><span class="in">tidy_df &lt;- bind_rows(</span></span>
<span id="cb17-195"><a href="#cb17-195" aria-hidden="true" tabindex="-1"></a><span class="in">  attack_germany %&gt;% mutate(Statistic = "Attack", Country = "Germany"),</span></span>
<span id="cb17-196"><a href="#cb17-196" aria-hidden="true" tabindex="-1"></a><span class="in">  attack_scotland %&gt;% mutate(Statistic = "Attack", Country = "Scotland"),</span></span>
<span id="cb17-197"><a href="#cb17-197" aria-hidden="true" tabindex="-1"></a><span class="in">  defense_germany %&gt;% mutate(Statistic = "Defense", Country = "Germany"),</span></span>
<span id="cb17-198"><a href="#cb17-198" aria-hidden="true" tabindex="-1"></a><span class="in">  defense_scotland %&gt;% mutate(Statistic = "Defense", Country = "Scotland")</span></span>
<span id="cb17-199"><a href="#cb17-199" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb17-200"><a href="#cb17-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-201"><a href="#cb17-201" aria-hidden="true" tabindex="-1"></a><span class="in"># Include the mean values in the plot</span></span>
<span id="cb17-202"><a href="#cb17-202" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(tidy_df, aes(x = A, fill = Country)) +</span></span>
<span id="cb17-203"><a href="#cb17-203" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(alpha = 0.5) +</span></span>
<span id="cb17-204"><a href="#cb17-204" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~ Statistic, scales = "free") +</span></span>
<span id="cb17-205"><a href="#cb17-205" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Posterior Distributions of Attack and Defense Strengths", x = "Strength", y = "Density") +</span></span>
<span id="cb17-206"><a href="#cb17-206" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(data = tidy_df %&gt;% group_by(Statistic, Country) %&gt;% summarise(mean_A = mean(A)), </span></span>
<span id="cb17-207"><a href="#cb17-207" aria-hidden="true" tabindex="-1"></a><span class="in">             aes(xintercept = mean_A, color = Country), linetype = "dashed") +</span></span>
<span id="cb17-208"><a href="#cb17-208" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() </span></span>
<span id="cb17-209"><a href="#cb17-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-210"><a href="#cb17-210" aria-hidden="true" tabindex="-1"></a><span class="fu">### Making predictions</span></span>
<span id="cb17-211"><a href="#cb17-211" aria-hidden="true" tabindex="-1"></a>We can now make predictions for the game Germany vs Scotland. Below are the first samples of the posterior distribution for the attack and defense strengths of germany and scotland.</span>
<span id="cb17-212"><a href="#cb17-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-213"><a href="#cb17-213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, collapse=TRUE, warning=FALSE, eval=TRUE}</span></span>
<span id="cb17-214"><a href="#cb17-214" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract first five samples for demonstration</span></span>
<span id="cb17-215"><a href="#cb17-215" aria-hidden="true" tabindex="-1"></a><span class="in">df = data.frame(attack_germany = attack_germany$A, defense_germany = defense_germany$A, attack_scotland = attack_scotland$A, defense_scotland = defense_scotland$A) %&gt;% head() </span></span>
<span id="cb17-216"><a href="#cb17-216" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::kable(df)</span></span>
<span id="cb17-217"><a href="#cb17-217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-218"><a href="#cb17-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-219"><a href="#cb17-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-220"><a href="#cb17-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-221"><a href="#cb17-221" aria-hidden="true" tabindex="-1"></a>We use the samples for posterior row by row to sample the number of goals for Germany and Scotland. We can use the samples to calculate the probability of a win, draw or loss for Germany.</span>
<span id="cb17-222"><a href="#cb17-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-223"><a href="#cb17-223" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE, collapse=FALSE, warning=FALSE}</span></span>
<span id="cb17-224"><a href="#cb17-224" aria-hidden="true" tabindex="-1"></a><span class="in"> theta_germany = exp(attack_germany$A - defense_scotland$A)</span></span>
<span id="cb17-225"><a href="#cb17-225" aria-hidden="true" tabindex="-1"></a><span class="in"> theta_scotland = exp(attack_scotland$A - defense_germany$A)</span></span>
<span id="cb17-226"><a href="#cb17-226" aria-hidden="true" tabindex="-1"></a><span class="in"> g_germany = rpois(length(theta_germany), theta_germany)</span></span>
<span id="cb17-227"><a href="#cb17-227" aria-hidden="true" tabindex="-1"></a><span class="in"> g_scotland = rpois(length(theta_scotland), theta_scotland)</span></span>
<span id="cb17-228"><a href="#cb17-228" aria-hidden="true" tabindex="-1"></a><span class="in"> mean(g_germany &gt; g_scotland) #Probability of Germany winning</span></span>
<span id="cb17-229"><a href="#cb17-229" aria-hidden="true" tabindex="-1"></a><span class="in"> mean(g_germany == g_scotland) #Probability of a draw</span></span>
<span id="cb17-230"><a href="#cb17-230" aria-hidden="true" tabindex="-1"></a><span class="in"> mean(g_germany &lt; g_scotland) #Probability of Scotland winning</span></span>
<span id="cb17-231"><a href="#cb17-231" aria-hidden="true" tabindex="-1"></a><span class="in"> </span></span>
<span id="cb17-232"><a href="#cb17-232" aria-hidden="true" tabindex="-1"></a><span class="in"> plot(table(g_germany)/length(g_germany), main='Germany Goals', xlab='Goals', ylab='Probability')</span></span>
<span id="cb17-233"><a href="#cb17-233" aria-hidden="true" tabindex="-1"></a><span class="in"> plot(table(g_scotland)/length(g_scotland), main='Scotland Goals', xlab='Goals', ylab='Probability')</span></span>
<span id="cb17-234"><a href="#cb17-234" aria-hidden="true" tabindex="-1"></a><span class="in"> </span></span>
<span id="cb17-235"><a href="#cb17-235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-236"><a href="#cb17-236" aria-hidden="true" tabindex="-1"></a>Remember the result? It was 5:1 for Germany. The model predicted a win for Germany with a probability of <span class="in">`r round(mean(g_germany &gt; g_scotland),2)`</span>. The probability of a draw was <span class="in">`r round(mean(g_germany == g_scotland),2)`</span> and the probability of Scotland winning was <span class="in">`r round(mean(g_germany &lt; g_scotland),2)`</span>. </span>
<span id="cb17-237"><a href="#cb17-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-238"><a href="#cb17-238" aria-hidden="true" tabindex="-1"></a>So that these predictions with a grain of salt. The model is based on historical data and does not take into account the current form of the teams.</span>
<span id="cb17-239"><a href="#cb17-239" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb17-240"><a href="#cb17-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-241"><a href="#cb17-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-242"><a href="#cb17-242" aria-hidden="true" tabindex="-1"></a><span class="fu"># Predictions</span></span>
<span id="cb17-243"><a href="#cb17-243" aria-hidden="true" tabindex="-1"></a>::: callout-caution </span>
<span id="cb17-244"><a href="#cb17-244" aria-hidden="true" tabindex="-1"></a>Note that these predictions are based on historical data and might do not take into account the current form of the teams. </span>
<span id="cb17-245"><a href="#cb17-245" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb17-246"><a href="#cb17-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-247"><a href="#cb17-247" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, message=FALSE, collapse=TRUE, warning=FALSE}</span></span>
<span id="cb17-248"><a href="#cb17-248" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb17-249"><a href="#cb17-249" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidybayes)</span></span>
<span id="cb17-250"><a href="#cb17-250" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggpubr)</span></span>
<span id="cb17-251"><a href="#cb17-251" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb17-252"><a href="#cb17-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-253"><a href="#cb17-253" aria-hidden="true" tabindex="-1"></a><span class="in"># Function to calculate probabilities for a pairing</span></span>
<span id="cb17-254"><a href="#cb17-254" aria-hidden="true" tabindex="-1"></a><span class="in">calculate_probabilities &lt;- function(team1, team2, teams, hfit) {</span></span>
<span id="cb17-255"><a href="#cb17-255" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(sprintf('## %s vs %s\n', team1, team2))</span></span>
<span id="cb17-256"><a href="#cb17-256" aria-hidden="true" tabindex="-1"></a><span class="in">  id1 &lt;- which(teams == team1)</span></span>
<span id="cb17-257"><a href="#cb17-257" aria-hidden="true" tabindex="-1"></a><span class="in">  id2 &lt;- which(teams == team2)</span></span>
<span id="cb17-258"><a href="#cb17-258" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb17-259"><a href="#cb17-259" aria-hidden="true" tabindex="-1"></a><span class="in">  # Spread draws and filter the relevant data</span></span>
<span id="cb17-260"><a href="#cb17-260" aria-hidden="true" tabindex="-1"></a><span class="in">  As &lt;- hfit %&gt;% tidybayes::spread_draws(A[i, j]) %&gt;% select(i, j, A)</span></span>
<span id="cb17-261"><a href="#cb17-261" aria-hidden="true" tabindex="-1"></a><span class="in">  att_1 &lt;- As %&gt;% filter(j == id1, i == 1)</span></span>
<span id="cb17-262"><a href="#cb17-262" aria-hidden="true" tabindex="-1"></a><span class="in">  att_2 &lt;- As %&gt;% filter(j == id2, i == 1)</span></span>
<span id="cb17-263"><a href="#cb17-263" aria-hidden="true" tabindex="-1"></a><span class="in">  def_1 &lt;- As %&gt;% filter(j == id1, i == 2)</span></span>
<span id="cb17-264"><a href="#cb17-264" aria-hidden="true" tabindex="-1"></a><span class="in">  def_2 &lt;- As %&gt;% filter(j == id2, i == 2)</span></span>
<span id="cb17-265"><a href="#cb17-265" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb17-266"><a href="#cb17-266" aria-hidden="true" tabindex="-1"></a><span class="in">  theta_1 &lt;- exp(att_1$A - def_2$A)</span></span>
<span id="cb17-267"><a href="#cb17-267" aria-hidden="true" tabindex="-1"></a><span class="in">  theta_2 &lt;- exp(att_2$A - def_1$A)</span></span>
<span id="cb17-268"><a href="#cb17-268" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb17-269"><a href="#cb17-269" aria-hidden="true" tabindex="-1"></a><span class="in">  g_1 &lt;- rpois(length(theta_1), theta_1)</span></span>
<span id="cb17-270"><a href="#cb17-270" aria-hidden="true" tabindex="-1"></a><span class="in">  g_2 &lt;- rpois(length(theta_2), theta_2)</span></span>
<span id="cb17-271"><a href="#cb17-271" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb17-272"><a href="#cb17-272" aria-hidden="true" tabindex="-1"></a><span class="in">  # Calculate probabilities</span></span>
<span id="cb17-273"><a href="#cb17-273" aria-hidden="true" tabindex="-1"></a><span class="in">  prob_win &lt;- mean(g_1 &gt; g_2)</span></span>
<span id="cb17-274"><a href="#cb17-274" aria-hidden="true" tabindex="-1"></a><span class="in">  prob_draw &lt;- mean(g_1 == g_2)</span></span>
<span id="cb17-275"><a href="#cb17-275" aria-hidden="true" tabindex="-1"></a><span class="in">  prob_lose &lt;- mean(g_1 &lt; g_2)</span></span>
<span id="cb17-276"><a href="#cb17-276" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb17-277"><a href="#cb17-277" aria-hidden="true" tabindex="-1"></a><span class="in">  # Return the probabilities and goals</span></span>
<span id="cb17-278"><a href="#cb17-278" aria-hidden="true" tabindex="-1"></a><span class="in">  list(</span></span>
<span id="cb17-279"><a href="#cb17-279" aria-hidden="true" tabindex="-1"></a><span class="in">    prob_win = round(prob_win,2),</span></span>
<span id="cb17-280"><a href="#cb17-280" aria-hidden="true" tabindex="-1"></a><span class="in">    prob_draw = round(prob_draw,2),</span></span>
<span id="cb17-281"><a href="#cb17-281" aria-hidden="true" tabindex="-1"></a><span class="in">    prob_lose = round(prob_lose,2),</span></span>
<span id="cb17-282"><a href="#cb17-282" aria-hidden="true" tabindex="-1"></a><span class="in">    g_1 = g_1,</span></span>
<span id="cb17-283"><a href="#cb17-283" aria-hidden="true" tabindex="-1"></a><span class="in">    g_2 = g_2</span></span>
<span id="cb17-284"><a href="#cb17-284" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb17-285"><a href="#cb17-285" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb17-286"><a href="#cb17-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-287"><a href="#cb17-287" aria-hidden="true" tabindex="-1"></a><span class="in">### Group stage matches</span></span>
<span id="cb17-288"><a href="#cb17-288" aria-hidden="true" tabindex="-1"></a><span class="in"># Quite a pain to get the data in the right format from a lying ChatGPT</span></span>
<span id="cb17-289"><a href="#cb17-289" aria-hidden="true" tabindex="-1"></a><span class="in">library(data.table)</span></span>
<span id="cb17-290"><a href="#cb17-290" aria-hidden="true" tabindex="-1"></a><span class="in"># Read the data from the CSV</span></span>
<span id="cb17-291"><a href="#cb17-291" aria-hidden="true" tabindex="-1"></a><span class="in">csv_data &lt;- "MatchNumber, Date, Team1, Team2, KickoffTime</span></span>
<span id="cb17-292"><a href="#cb17-292" aria-hidden="true" tabindex="-1"></a><span class="in">1, 14.06, Germany, Scotland, 21:00</span></span>
<span id="cb17-293"><a href="#cb17-293" aria-hidden="true" tabindex="-1"></a><span class="in">2, 15.06, Hungary, Switzerland, 15:00</span></span>
<span id="cb17-294"><a href="#cb17-294" aria-hidden="true" tabindex="-1"></a><span class="in">3, 15.06, Spain, Croatia, 18:00</span></span>
<span id="cb17-295"><a href="#cb17-295" aria-hidden="true" tabindex="-1"></a><span class="in">4, 15.06, Italy, Albania, 21:00</span></span>
<span id="cb17-296"><a href="#cb17-296" aria-hidden="true" tabindex="-1"></a><span class="in">5, 16.06, Serbia, England, 21:00</span></span>
<span id="cb17-297"><a href="#cb17-297" aria-hidden="true" tabindex="-1"></a><span class="in">6, 16.06, Slovenia, Denmark, 18:00</span></span>
<span id="cb17-298"><a href="#cb17-298" aria-hidden="true" tabindex="-1"></a><span class="in">7, 16.06, Poland, Netherlands, 15:00</span></span>
<span id="cb17-299"><a href="#cb17-299" aria-hidden="true" tabindex="-1"></a><span class="in">8, 17.06, Austria, France, 21:00</span></span>
<span id="cb17-300"><a href="#cb17-300" aria-hidden="true" tabindex="-1"></a><span class="in">9, 17.06, Belgium, Slovakia, 18:00</span></span>
<span id="cb17-301"><a href="#cb17-301" aria-hidden="true" tabindex="-1"></a><span class="in">10, 17.06, Romania, Ukraine, 15:00</span></span>
<span id="cb17-302"><a href="#cb17-302" aria-hidden="true" tabindex="-1"></a><span class="in">11, 18.06, TÃ¼rkiye, Georgia, 18:00</span></span>
<span id="cb17-303"><a href="#cb17-303" aria-hidden="true" tabindex="-1"></a><span class="in">12, 18.06, Portugal, Czechia, 21:00</span></span>
<span id="cb17-304"><a href="#cb17-304" aria-hidden="true" tabindex="-1"></a><span class="in">13, 19.06, Scotland, Switzerland, 21:00</span></span>
<span id="cb17-305"><a href="#cb17-305" aria-hidden="true" tabindex="-1"></a><span class="in">14, 19.06, Germany, Hungary, 18:00</span></span>
<span id="cb17-306"><a href="#cb17-306" aria-hidden="true" tabindex="-1"></a><span class="in">15, 19.06, Croatia, Albania, 15:00</span></span>
<span id="cb17-307"><a href="#cb17-307" aria-hidden="true" tabindex="-1"></a><span class="in">16, 19.06, Spain, Italy, 21:00</span></span>
<span id="cb17-308"><a href="#cb17-308" aria-hidden="true" tabindex="-1"></a><span class="in">17, 20.06, Denmark, England, 18:00</span></span>
<span id="cb17-309"><a href="#cb17-309" aria-hidden="true" tabindex="-1"></a><span class="in">18, 20.06, Slovenia, Serbia, 15:00</span></span>
<span id="cb17-310"><a href="#cb17-310" aria-hidden="true" tabindex="-1"></a><span class="in">19, 20.06, Poland, Austria, 18:00</span></span>
<span id="cb17-311"><a href="#cb17-311" aria-hidden="true" tabindex="-1"></a><span class="in">20, 20.06, Netherlands, France, 21:00</span></span>
<span id="cb17-312"><a href="#cb17-312" aria-hidden="true" tabindex="-1"></a><span class="in">21, 21.06, Slovakia, Ukraine, 15:00</span></span>
<span id="cb17-313"><a href="#cb17-313" aria-hidden="true" tabindex="-1"></a><span class="in">22, 21.06, Belgium, Romania, 21:00</span></span>
<span id="cb17-314"><a href="#cb17-314" aria-hidden="true" tabindex="-1"></a><span class="in">23, 21.06, TÃ¼rkiye, Portugal, 18:00</span></span>
<span id="cb17-315"><a href="#cb17-315" aria-hidden="true" tabindex="-1"></a><span class="in">24, 21.06, Georgia, Czechia, 15:00</span></span>
<span id="cb17-316"><a href="#cb17-316" aria-hidden="true" tabindex="-1"></a><span class="in">25, 25.06, Switzerland, Germany, 21:00</span></span>
<span id="cb17-317"><a href="#cb17-317" aria-hidden="true" tabindex="-1"></a><span class="in">26, 25.06, Scotland, Hungary, 21:00</span></span>
<span id="cb17-318"><a href="#cb17-318" aria-hidden="true" tabindex="-1"></a><span class="in">27, 25.06, Albania, Spain, 21:00</span></span>
<span id="cb17-319"><a href="#cb17-319" aria-hidden="true" tabindex="-1"></a><span class="in">28, 25.06, Croatia, Italy, 21:00</span></span>
<span id="cb17-320"><a href="#cb17-320" aria-hidden="true" tabindex="-1"></a><span class="in">29, 25.06, England, Slovenia, 21:00</span></span>
<span id="cb17-321"><a href="#cb17-321" aria-hidden="true" tabindex="-1"></a><span class="in">30, 25.06, Denmark, Serbia, 21:00</span></span>
<span id="cb17-322"><a href="#cb17-322" aria-hidden="true" tabindex="-1"></a><span class="in">31, 25.06, Netherlands, Austria, 18:00</span></span>
<span id="cb17-323"><a href="#cb17-323" aria-hidden="true" tabindex="-1"></a><span class="in">32, 25.06, France, Poland, 18:00</span></span>
<span id="cb17-324"><a href="#cb17-324" aria-hidden="true" tabindex="-1"></a><span class="in">33, 25.06, Slovakia, Romania, 18:00</span></span>
<span id="cb17-325"><a href="#cb17-325" aria-hidden="true" tabindex="-1"></a><span class="in">34, 25.06, Ukraine, Belgium, 18:00</span></span>
<span id="cb17-326"><a href="#cb17-326" aria-hidden="true" tabindex="-1"></a><span class="in">35, 25.06, Georgia, Portugal, 21:00</span></span>
<span id="cb17-327"><a href="#cb17-327" aria-hidden="true" tabindex="-1"></a><span class="in">36, 25.06, Czechia, TÃ¼rkiye, 21:00"</span></span>
<span id="cb17-328"><a href="#cb17-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-329"><a href="#cb17-329" aria-hidden="true" tabindex="-1"></a><span class="in"># Convert CSV data to data table</span></span>
<span id="cb17-330"><a href="#cb17-330" aria-hidden="true" tabindex="-1"></a><span class="in">matches_raw &lt;- fread(text = csv_data)</span></span>
<span id="cb17-331"><a href="#cb17-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-332"><a href="#cb17-332" aria-hidden="true" tabindex="-1"></a><span class="in">matches = data.frame(Date=as.Date(paste0('2024-06-', matches_raw$Date)), Time=paste0(matches_raw$KickoffTime, ' CEST'), HomeTeam=matches_raw$Team1, AwayTeam=matches_raw$Team2)</span></span>
<span id="cb17-333"><a href="#cb17-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-334"><a href="#cb17-334" aria-hidden="true" tabindex="-1"></a><span class="in">results = data.frame(num=NULL,Date=NULL, Time=NULL, HomeTeam=NULL, AwayTeam=NULL, Win=NULL, Draw=NULL, Lose=NULL)</span></span>
<span id="cb17-335"><a href="#cb17-335" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nrow(matches)) {</span></span>
<span id="cb17-336"><a href="#cb17-336" aria-hidden="true" tabindex="-1"></a><span class="in">  # i=1</span></span>
<span id="cb17-337"><a href="#cb17-337" aria-hidden="true" tabindex="-1"></a><span class="in">  #cat(sprintf('## %s vs %s\n', matches[i,3], matches[i,4]))</span></span>
<span id="cb17-338"><a href="#cb17-338" aria-hidden="true" tabindex="-1"></a><span class="in">  probs &lt;- calculate_probabilities(matches[i,3,drop=TRUE], matches[i,4,drop=TRUE], teams, hfit)</span></span>
<span id="cb17-339"><a href="#cb17-339" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(sprintf('Win: %.2f, Draw: %.2f, Lose: %.2f\n', probs$prob_win, probs$prob_draw, probs$prob_lose))</span></span>
<span id="cb17-340"><a href="#cb17-340" aria-hidden="true" tabindex="-1"></a><span class="in">  results = rbind(results, data.frame(</span></span>
<span id="cb17-341"><a href="#cb17-341" aria-hidden="true" tabindex="-1"></a><span class="in">    Number = i,</span></span>
<span id="cb17-342"><a href="#cb17-342" aria-hidden="true" tabindex="-1"></a><span class="in">    Date=matches[i,1], </span></span>
<span id="cb17-343"><a href="#cb17-343" aria-hidden="true" tabindex="-1"></a><span class="in">    Time=matches[i,2], </span></span>
<span id="cb17-344"><a href="#cb17-344" aria-hidden="true" tabindex="-1"></a><span class="in">    HomeTeam=matches[i,3], </span></span>
<span id="cb17-345"><a href="#cb17-345" aria-hidden="true" tabindex="-1"></a><span class="in">    AwayTeam=matches[i,4], </span></span>
<span id="cb17-346"><a href="#cb17-346" aria-hidden="true" tabindex="-1"></a><span class="in">    Win=probs$prob_win, Draw=probs$prob_draw, Lose=probs$prob_lose))</span></span>
<span id="cb17-347"><a href="#cb17-347" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb17-348"><a href="#cb17-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-349"><a href="#cb17-349" aria-hidden="true" tabindex="-1"></a><span class="in"># Print the summary table with links</span></span>
<span id="cb17-350"><a href="#cb17-350" aria-hidden="true" tabindex="-1"></a><span class="in">kable(results, caption = "Probabilities of Match Outcomes", escape = FALSE)</span></span>
<span id="cb17-351"><a href="#cb17-351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-352"><a href="#cb17-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-353"><a href="#cb17-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-354"><a href="#cb17-354" aria-hidden="true" tabindex="-1"></a><span class="fu">## Details on individual games</span></span>
<span id="cb17-355"><a href="#cb17-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-356"><a href="#cb17-356" aria-hidden="true" tabindex="-1"></a><span class="fu">### Goal Distributions</span></span>
<span id="cb17-357"><a href="#cb17-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-358"><a href="#cb17-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-359"><a href="#cb17-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-360"><a href="#cb17-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r individual_plots, echo=FALSE, results='asis', fig.width=7, fig.height=2}</span></span>
<span id="cb17-361"><a href="#cb17-361" aria-hidden="true" tabindex="-1"></a><span class="in"># Function to generate plot for a pairing</span></span>
<span id="cb17-362"><a href="#cb17-362" aria-hidden="true" tabindex="-1"></a><span class="in">generate_plot &lt;- function(team1, team2, teams, hfit) {</span></span>
<span id="cb17-363"><a href="#cb17-363" aria-hidden="true" tabindex="-1"></a><span class="in">  #cat(team1, team2)</span></span>
<span id="cb17-364"><a href="#cb17-364" aria-hidden="true" tabindex="-1"></a><span class="in">  id1 &lt;- which(teams == team1)</span></span>
<span id="cb17-365"><a href="#cb17-365" aria-hidden="true" tabindex="-1"></a><span class="in">  id2 &lt;- which(teams == team2)</span></span>
<span id="cb17-366"><a href="#cb17-366" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb17-367"><a href="#cb17-367" aria-hidden="true" tabindex="-1"></a><span class="in">  # Spread draws and filter the relevant data</span></span>
<span id="cb17-368"><a href="#cb17-368" aria-hidden="true" tabindex="-1"></a><span class="in">  As &lt;- hfit %&gt;% tidybayes::spread_draws(A[i, j]) %&gt;% select(i, j, A)</span></span>
<span id="cb17-369"><a href="#cb17-369" aria-hidden="true" tabindex="-1"></a><span class="in">  att_1 &lt;- As %&gt;% filter(j == id1, i == 1)</span></span>
<span id="cb17-370"><a href="#cb17-370" aria-hidden="true" tabindex="-1"></a><span class="in">  att_2 &lt;- As %&gt;% filter(j == id2, i == 1)</span></span>
<span id="cb17-371"><a href="#cb17-371" aria-hidden="true" tabindex="-1"></a><span class="in">  def_1 &lt;- As %&gt;% filter(j == id1, i == 2)</span></span>
<span id="cb17-372"><a href="#cb17-372" aria-hidden="true" tabindex="-1"></a><span class="in">  def_2 &lt;- As %&gt;% filter(j == id2, i == 2)</span></span>
<span id="cb17-373"><a href="#cb17-373" aria-hidden="true" tabindex="-1"></a><span class="in">   </span></span>
<span id="cb17-374"><a href="#cb17-374" aria-hidden="true" tabindex="-1"></a><span class="in">  theta_1 &lt;- exp(att_1$A - def_2$A)</span></span>
<span id="cb17-375"><a href="#cb17-375" aria-hidden="true" tabindex="-1"></a><span class="in">  theta_2 &lt;- exp(att_2$A - def_1$A)</span></span>
<span id="cb17-376"><a href="#cb17-376" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb17-377"><a href="#cb17-377" aria-hidden="true" tabindex="-1"></a><span class="in">  g_1 &lt;- rpois(length(theta_1), theta_1)</span></span>
<span id="cb17-378"><a href="#cb17-378" aria-hidden="true" tabindex="-1"></a><span class="in">  g_2 &lt;- rpois(length(theta_2), theta_2)</span></span>
<span id="cb17-379"><a href="#cb17-379" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb17-380"><a href="#cb17-380" aria-hidden="true" tabindex="-1"></a><span class="in">  # Calculate mean goals</span></span>
<span id="cb17-381"><a href="#cb17-381" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_g1 &lt;- mean(g_1)</span></span>
<span id="cb17-382"><a href="#cb17-382" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_g2 &lt;- mean(g_2)</span></span>
<span id="cb17-383"><a href="#cb17-383" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb17-384"><a href="#cb17-384" aria-hidden="true" tabindex="-1"></a><span class="in">  # Create a data frame for the goal distributions</span></span>
<span id="cb17-385"><a href="#cb17-385" aria-hidden="true" tabindex="-1"></a><span class="in">  goal_dist &lt;- data.frame(</span></span>
<span id="cb17-386"><a href="#cb17-386" aria-hidden="true" tabindex="-1"></a><span class="in">    goals = c(g_1, g_2),</span></span>
<span id="cb17-387"><a href="#cb17-387" aria-hidden="true" tabindex="-1"></a><span class="in">    team = rep(c(team1, team2), each = length(g_1))</span></span>
<span id="cb17-388"><a href="#cb17-388" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb17-389"><a href="#cb17-389" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb17-390"><a href="#cb17-390" aria-hidden="true" tabindex="-1"></a><span class="in">  # Plot the goal distributions for each team with mean values</span></span>
<span id="cb17-391"><a href="#cb17-391" aria-hidden="true" tabindex="-1"></a><span class="in">  p1 &lt;- ggplot(goal_dist %&gt;% filter(team == team1), aes(x = factor(goals))) +</span></span>
<span id="cb17-392"><a href="#cb17-392" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bar(aes(y = after_stat(count) / sum(after_stat(count))), fill = "blue", color = "black", alpha = 0.7) +</span></span>
<span id="cb17-393"><a href="#cb17-393" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(title = paste("Goals for", team1, "(Expected:", round(mean_g1, 2), ")"), x = "Goals", y = "Probability") +</span></span>
<span id="cb17-394"><a href="#cb17-394" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_minimal() +</span></span>
<span id="cb17-395"><a href="#cb17-395" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_vline(xintercept = mean_g1, linetype = "dashed", color = "blue")</span></span>
<span id="cb17-396"><a href="#cb17-396" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb17-397"><a href="#cb17-397" aria-hidden="true" tabindex="-1"></a><span class="in">  p2 &lt;- ggplot(goal_dist %&gt;% filter(team == team2), aes(x = factor(goals))) +</span></span>
<span id="cb17-398"><a href="#cb17-398" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bar(aes(y = after_stat(count) / sum(after_stat(count))), fill = "red", color = "black", alpha = 0.7) +</span></span>
<span id="cb17-399"><a href="#cb17-399" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(title = paste("Goals for", team2, "(Expected:", round(mean_g2, 2), ")"), x = "Goals", y = "Probability") +</span></span>
<span id="cb17-400"><a href="#cb17-400" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_minimal() +</span></span>
<span id="cb17-401"><a href="#cb17-401" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_vline(xintercept = mean_g2, linetype = "dashed", color = "red")</span></span>
<span id="cb17-402"><a href="#cb17-402" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb17-403"><a href="#cb17-403" aria-hidden="true" tabindex="-1"></a><span class="in">  # Arrange the plots side by side</span></span>
<span id="cb17-404"><a href="#cb17-404" aria-hidden="true" tabindex="-1"></a><span class="in">  combined_plot &lt;- ggarrange(p1, p2, ncol = 2, nrow = 1)</span></span>
<span id="cb17-405"><a href="#cb17-405" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb17-406"><a href="#cb17-406" aria-hidden="true" tabindex="-1"></a><span class="in">  return(combined_plot)</span></span>
<span id="cb17-407"><a href="#cb17-407" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb17-408"><a href="#cb17-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-409"><a href="#cb17-409" aria-hidden="true" tabindex="-1"></a><span class="in"># Generate plots for all pairings and display them</span></span>
<span id="cb17-410"><a href="#cb17-410" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in 1:nrow(matches)) {</span></span>
<span id="cb17-411"><a href="#cb17-411" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(sprintf('\n## %d %s vs %s\n',i, matches[i,3], matches[i,4]))</span></span>
<span id="cb17-412"><a href="#cb17-412" aria-hidden="true" tabindex="-1"></a><span class="in">  #cat(sprintf('&lt;div id="%s-%s-plot"&gt;&lt;/div&gt;\n', gsub(" ", "-", matches[i,3]), gsub(" ", "-", matches[i,4])))</span></span>
<span id="cb17-413"><a href="#cb17-413" aria-hidden="true" tabindex="-1"></a><span class="in">  plot &lt;- generate_plot(matches[i,3,drop=TRUE], matches[i,4,drop=TRUE], teams, hfit)</span></span>
<span id="cb17-414"><a href="#cb17-414" aria-hidden="true" tabindex="-1"></a><span class="in">  print(plot)</span></span>
<span id="cb17-415"><a href="#cb17-415" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(sprintf('\n'))</span></span>
<span id="cb17-416"><a href="#cb17-416" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb17-417"><a href="#cb17-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-418"><a href="#cb17-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-419"><a href="#cb17-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-420"><a href="#cb17-420" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>